<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>河南省商务中等职业学校</title>
  
  
  <link href="https://www.hnswxx.cn/atom.xml" rel="self"/>
  
  <link href="https://www.hnswxx.cn/"/>
  <updated>2022-02-15T01:39:19.641Z</updated>
  <id>https://www.hnswxx.cn/</id>
  
  <author>
    <name>网络搭建竞赛组</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>debian11 openldap 目录服务</title>
    <link href="https://www.hnswxx.cn/2022/02/15/debian11-openldap/"/>
    <id>https://www.hnswxx.cn/2022/02/15/debian11-openldap/</id>
    <published>2022-02-15T01:19:38.000Z</published>
    <updated>2022-02-15T01:39:19.641Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="配置-LDAP-服务器以共享本地网络中的用户帐户"><a href="#配置-LDAP-服务器以共享本地网络中的用户帐户" class="headerlink" title="配置 LDAP 服务器以共享本地网络中的用户帐户"></a>配置 LDAP 服务器以共享本地网络中的用户帐户</h2><p><strong>配置LDAP服务端</strong></p><ol><li>安装openldap</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">aptitude install slapd ldap-utils -y</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在安装过程中设置 LDAP 管理员密码，如下所示‎</span></span><br><span class="line"> +--------------------------| Configuring slapd |-------------------------+</span><br><span class="line"> | Please enter the password for the admin entry in your LDAP directory.  |</span><br><span class="line"> |                                                                        |</span><br><span class="line"> | Administrator password:                                                |</span><br><span class="line"> |                                                                        |</span><br><span class="line"> | ********______________________________________________________________ |</span><br><span class="line"> |                                                                        |</span><br><span class="line"> |                                 &lt;Ok&gt;                                   |</span><br><span class="line"> |                                                                        |</span><br><span class="line"> +------------------------------------------------------------------------+</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">确认设置</span></span><br><span class="line">slapcat</span><br><span class="line">dn: dc=test,dc=com</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: dcObject</span><br><span class="line">objectClass: organization</span><br><span class="line">o: test.com</span><br><span class="line">dc: test</span><br><span class="line">structuralObjectClass: organization</span><br><span class="line">entryUUID: ecd0d368-218a-103c-9a44-3b8fc76e7f1d</span><br><span class="line">creatorsName: cn=admin,dc=test,dc=com</span><br><span class="line">createTimestamp: 20220214023823Z</span><br><span class="line">entryCSN: 20220214023823.995080Z#000000#000#000000</span><br><span class="line">modifiersName: cn=admin,dc=test,dc=com</span><br><span class="line">modifyTimestamp: 20220214023823Z</span><br></pre></td></tr></table></figure><ol start="2"><li>为用户和组添加基本 dn</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">vim base.ldif</span><br><span class="line">dn: ou=people,dc=test,dc=com</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: people</span><br><span class="line"></span><br><span class="line">dn: ou=groups,dc=test,dc=world</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line">ou: groups </span><br><span class="line"></span><br><span class="line">ldapadd -x -D cn=admin,dc=test,dc=com -W -f base.ldif</span><br><span class="line">Enter LDAP Password: </span><br><span class="line">adding new entry &quot;ou=people,dc=test,dc=com&quot;</span><br><span class="line"></span><br><span class="line">adding new entry &quot;ou=groups,dc=test,dc=com&quot;</span><br></pre></td></tr></table></figure><p><strong>添加用户帐户</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 生成加密密码</span></span><br><span class="line">slappasswd</span><br><span class="line">New password: </span><br><span class="line">Re-enter new password: </span><br><span class="line">&#123;SSHA&#125;MvbqkEE4vpw+QMxe1e3S5gbZHGaJS6h7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建用户ldif文件</span></span><br><span class="line">vim ldapuser.ldif</span><br><span class="line">dn: uid=bullseye,ou=people,dc=test,dc=com</span><br><span class="line">objectClass: inetOrgPerson</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">cn: bullseye</span><br><span class="line">sn: ubuntu</span><br><span class="line">userPassword: &#123;SSHA&#125;MvbqkEE4vpw+QMxe1e3S5gbZHGaJS6h7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 2000</span><br><span class="line">gidNumber: 2000</span><br><span class="line">homeDirectory: /home/bullseye</span><br><span class="line"></span><br><span class="line">dn: cn=bullseye,ou=groups,dc=test,dc=com</span><br><span class="line">objectClass: posixGroup</span><br><span class="line">cn: bullseye</span><br><span class="line">gidNumber: 2000</span><br><span class="line">memberUid: bullseye</span><br><span class="line"></span><br><span class="line">ldapadd -x -D cn=admin,dc=test,dc=com -W -f ldapuser.ldif</span><br><span class="line">Enter LDAP Password:</span><br><span class="line">adding new entry &quot;uid=bullseye,ou=people,dc=test,dc=com&quot;</span><br><span class="line"></span><br><span class="line">adding new entry &quot;cn=bullseye,ou=groups,dc=test,dc=com&quot;</span><br></pre></td></tr></table></figure><p><strong>配置LDAP客户端</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">aptitude install libnss-ldapd libpam-ldapd ldap-utils -y</span><br><span class="line">（1） 指定 LDAP 服务器的 URI</span><br><span class="line"> +---------------------| Configuring ldap-auth-config |----------------------+</span><br><span class="line"> | Please enter the URI of the LDAP server to use. This is a string in the   |</span><br><span class="line"> | form of ldap://&lt;hostname or IP&gt;:&lt;port&gt;/. ldaps:// or ldapi:// can also    |</span><br><span class="line"> | be used. The port number is optional.                                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | Note: It is usually a good idea to use an IP address because it reduces   |</span><br><span class="line"> | risks of failure in the event name service problems.                      |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | LDAP server Uniform Resource Identifier:                                  |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | ldap://test1.test.com/________________________________________________    |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                                  &lt;Ok&gt;                                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> +---------------------------------------------------------------------------+</span><br><span class="line">（2）指定后缀</span><br><span class="line"> +---------------------| Configuring ldap-auth-config |----------------------+</span><br><span class="line"> | Please enter the distinguished name of the LDAP search base. Many sites   |</span><br><span class="line"> | use the components of their domain names for this purpose. For example,   |</span><br><span class="line"> | the domain &quot;example.net&quot; would use &quot;dc=example,dc=net&quot; as the             |</span><br><span class="line"> | distinguished name of the search base.                                    |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | Distinguished name of the search base:                                    |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | dc=test,dc=com________________________________________________________    |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                                  &lt;Ok&gt;                                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> +---------------------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">（3）选择应该启用LDAP查找的服务</span><br><span class="line"> +-----------------------+ Configuring libnss-ldapd +------------------------+</span><br><span class="line"> | For this package to work, you need to modify the /etc/nsswitch.conf file  |</span><br><span class="line"> | to use the ldap datasource.                                               |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | You can select the services that should have LDAP lookups enabled. The    |</span><br><span class="line"> | new LDAP lookups will be added as the last datasource. Be sure to review  |</span><br><span class="line"> | these changes.                                                            |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> | Name services to configure:                                               |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |    [*] passwd                                                             |</span><br><span class="line"> |    [*] group                                                              |</span><br><span class="line"> |    [*] shadow                                                             |</span><br><span class="line"> |    [ ] hosts                                                              |</span><br><span class="line"> |    [ ] networks                                                           |</span><br><span class="line"> │    [ ] ethers                                                             │ </span><br><span class="line"> │    [ ] protocols                                                          │ </span><br><span class="line"> │    [ ] services                                                           │ </span><br><span class="line"> │    [ ] rpc                                                                │ </span><br><span class="line"> │    [ ] netgroup                                                           │ </span><br><span class="line"> │    [ ] aliases                                                            │ </span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> |                                  &lt;Ok&gt;                                     |</span><br><span class="line"> |                                                                           |</span><br><span class="line"> +---------------------------------------------------------------------------+</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash">初始登录自动创建主目录，添加到末尾</span></span><br><span class="line">/etc/pam.d/common-session</span><br><span class="line">session optional        pam_mkhomedir.so skel=/etc/skel umask=077</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">重启服务</span></span><br><span class="line">systemctl restart nscd nslcd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">测试重新登陆</span></span><br><span class="line">Debian GNU/Linux 11 test2.test.com ttyS0</span><br><span class="line"></span><br><span class="line">test2 login: bullseye     # LDAP user</span><br><span class="line">Password:</span><br><span class="line">Linux test2.test.com 5.10.0-8-amd64 #1 SMP Debian 5.10.46-4 (2021-12-08) x86_64</span><br><span class="line"></span><br><span class="line">The programs included with the Debian GNU/Linux system are free software;</span><br><span class="line">the exact distribution terms for each program are described in the</span><br><span class="line">individual files in /usr/share/doc/*/copyright.</span><br><span class="line"></span><br><span class="line">Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent</span><br><span class="line">permitted by applicable law.</span><br><span class="line">Creating directory &#x27;/home/bullseye&#x27;.</span><br><span class="line">bullseye@test2:~$           # 刚刚登录</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改密码如下</span></span><br><span class="line">bullseye@test2:~$ passwd</span><br><span class="line">(current) LDAP Password:     # 当前密码</span><br><span class="line">New password:                # 新密码</span><br><span class="line">Retype new password:</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">bullseye@test2:~$           # 更改成功</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Debian11" scheme="https://www.hnswxx.cn/tags/Debian11/"/>
    
    <category term="openldap" scheme="https://www.hnswxx.cn/tags/openldap/"/>
    
  </entry>
  
  <entry>
    <title>debian11 ntp 时间同步配置</title>
    <link href="https://www.hnswxx.cn/2022/02/10/debian11-ntp/"/>
    <id>https://www.hnswxx.cn/2022/02/10/debian11-ntp/</id>
    <published>2022-02-10T08:57:37.000Z</published>
    <updated>2022-02-15T01:39:16.353Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="安装ntp"><a href="#安装ntp" class="headerlink" title="安装ntp"></a>安装ntp</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">aptitude install ntp -y</span><br><span class="line"><span class="meta">#</span><span class="bash">查看ntp包信息</span></span><br><span class="line">aptitude show ntp</span><br><span class="line">Package: ntp                             </span><br><span class="line">Version: 1:4.2.8p15+dfsg-1</span><br><span class="line">State: installed</span><br><span class="line">Automatically installed: no</span><br><span class="line">Priority: optional</span><br><span class="line">Section: net</span><br><span class="line">Maintainer: Debian NTP Team &lt;ntp@packages.debian.org&gt;</span><br><span class="line">Architecture: amd64</span><br><span class="line">Uncompressed Size: 2169 k</span><br><span class="line">Depends: adduser, lsb-base (&gt;= 3.2-13), netbase, tzdata, libc6</span><br><span class="line">         (&gt;= 2.17), libcap2 (&gt;= 1:2.10), libedit2 (&gt;=</span><br><span class="line">         2.11-20080614-0), libopts25 (&gt;= 1:5.18.16), libssl1.1</span><br><span class="line">         (&gt;= 1.1.0)</span><br><span class="line">Recommends: sntp, perl:any</span><br><span class="line">Suggests: ntp-doc</span><br><span class="line">Conflicts: time-daemon</span><br><span class="line">Replaces: time-daemon</span><br><span class="line">Provides: time-daemon</span><br><span class="line">Description: Network Time Protocol daemon and utility programs</span><br><span class="line"> NTP, the Network Time Protocol, is used to keep computer</span><br><span class="line"> clocks accurate by synchronizing them over the Internet or a</span><br><span class="line"> local network, or by following an accurate hardware receiver</span><br><span class="line"> that interprets GPS, DCF-77, NIST or similar time signals. </span><br><span class="line">  </span><br><span class="line"> This package contains the NTP daemon and utility programs.</span><br><span class="line"> An NTP daemon needs to be running on each host that is to</span><br><span class="line"> have its clock accuracy controlled by NTP.  The same NTP</span><br><span class="line"> daemon is also used to provide NTP service to other hosts. </span><br><span class="line">  </span><br><span class="line"> For more information about the NTP protocol and NTP server</span><br><span class="line"> configuration and operation, install the package &quot;ntp-doc&quot;.</span><br><span class="line">Homepage: http://support.ntp.org/</span><br><span class="line">Tags: admin::benchmarking, admin::configuring,</span><br><span class="line">      implemented-in::c, interface::commandline,</span><br><span class="line">      interface::daemon, network::server, network::service,</span><br><span class="line">      protocol::TODO, role::program, scope::utility,</span><br><span class="line">      use::monitor, use::timekeeping</span><br></pre></td></tr></table></figure><h4 id="ntp配置详解"><a href="#ntp配置详解" class="headerlink" title="ntp配置详解"></a>ntp配置详解</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> /etc/ntp.conf, configuration <span class="keyword">for</span> ntpd; see ntp.conf(5) <span class="keyword">for</span> <span class="built_in">help</span></span></span><br><span class="line"> </span><br><span class="line">driftfile /var/lib/ntp/ntp.drift</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Leap seconds definition provided by tzdata</span></span><br><span class="line">leapfile /usr/share/zoneinfo/leap-seconds.list</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Enable this <span class="keyword">if</span> you want statistics to be logged.</span></span><br><span class="line"><span class="meta">#</span><span class="bash">statsdir /var/<span class="built_in">log</span>/ntpstats/</span></span><br><span class="line"> </span><br><span class="line">statistics loopstats peerstats clockstats</span><br><span class="line">filegen loopstats file loopstats type day enable</span><br><span class="line">filegen peerstats file peerstats type day enable</span><br><span class="line">filegen clockstats file clockstats type day enable</span><br><span class="line"> </span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> You <span class="keyword">do</span> need to talk to an NTP server or two (or three).</span></span><br><span class="line"><span class="meta">#</span><span class="bash">server ntp.your-provider.example</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pick a different <span class="built_in">set</span> every time it starts up.  Please consider joining the</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> pool: &lt; http://www.pool.ntp.org/join.html&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash">以下四条为默认，注释掉即可</span></span><br><span class="line">pool 0.debian.pool.ntp.org iburst </span><br><span class="line">pool 1.debian.pool.ntp.org iburst</span><br><span class="line">pool 2.debian.pool.ntp.org iburst</span><br><span class="line">pool 3.debian.pool.ntp.org iburst</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash">server：用来设置上层NTP服务器，说白了就是client向谁请求NTP时间同步。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">特别注意，在内网环境中由于无法连接到内网，所以没有办法向例如国家授时服务中心210.72.145.44同步时间</span></span><br><span class="line"><span class="meta">#</span><span class="bash">只能将内网中的某台主机设置为server,用以向其他内网服务器提供NTP服务。</span></span><br><span class="line">server 127.127.1.0 prefer </span><br><span class="line"><span class="meta">#</span><span class="bash">以本机时间作为时间服务。内网中这个配置一定要加上，否则会导致NTP服务不可用</span></span><br><span class="line"><span class="meta">#</span><span class="bash">prefer代表这台主机优先级最高</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html <span class="keyword">for</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> details.  The web page &lt; http://support.ntp.org/bin/view/Support/AccessRestrictions&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> might also be helpful.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"></span></span><br><span class="line"><span class="bash"><span class="comment"># Note that &quot;restrict&quot; applies to both servers and clients, so a configuration</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> that might be intended to block requests from certain clients could also end</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> up blocking replies from your own upstream servers.</span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"> By default, exchange time with everybody, but don<span class="string">&#x27;t allow configuration.</span></span></span><br><span class="line">restrict -4 default kod notrap nomodify nopeer noquery limited</span><br><span class="line">restrict -6 default kod notrap nomodify nopeer noquery limited</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Local users may interrogate the ntp server more closely.</span></span></span><br><span class="line">restrict 127.0.0.1 #以下两条默认，放行本机来源</span><br><span class="line">restrict ::1</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Needed for adding pool entries</span></span></span><br><span class="line">restrict source notrap nomodify noquery</span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> Clients from this (example!) subnet have unlimited access, but only if</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> cryptographically authenticated.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">restrict 192.168.123.0 mask 255.255.255.0 notrust</span></span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">restrict用来管理权限控制。格式为 restrict [单个ip|网络|default] parameter</span></span></span><br><span class="line">    #parameter：</span><br><span class="line">        #ignore：拒绝所有的ntp连接</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">nomodify：客户端不能使用ntpc和ntpq这两个程序来更改服务器的时间参数，但客户端可以通过此主机来进行网络校时。</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">noquery：客户端不能使用ntpc和ntpq等命令来查询时间服务器，等于不提供网络校时服务。</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">notrap：不提供trap这个网络时间登陆的功能</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">notrust：拒绝没有认证的客户端</span></span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> If you want to provide time to your local subnet, change the next line.</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> (Again, the address is an example only.)</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">broadcast 192.168.123.255</span></span></span><br><span class="line"><span class="meta"> </span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> If you want to listen to time broadcasts on your local subnet, de-comment the</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string"> next lines.  Please do this only if you trust everybody on the network!</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">disable auth</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="string">broadcastclient</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><h5 id="服务端"><a href="#服务端" class="headerlink" title="服务端"></a>服务端</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">注释</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 0.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 1.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 2.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 3.debian.pool.ntp.org iburst</span></span><br><span class="line"> </span><br><span class="line">server 127.127.1.0 prefer  #设置本机为NTP服务器</span><br><span class="line">restrict 10.10.70.0 mask 255.255.255.0 #允许客户端10.10.70.0网段的所有主机向本机请求时间同步</span><br></pre></td></tr></table></figure><h5 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/etc/ntp.conf</span><br><span class="line"><span class="meta">#</span><span class="bash">注释</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 0.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 1.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 2.debian.pool.ntp.org iburst</span></span><br><span class="line"><span class="meta">#</span><span class="bash">pool 3.debian.pool.ntp.org iburst</span></span><br><span class="line"> </span><br><span class="line">server 10.10.70.101  #指名上层NTP服务器</span><br></pre></td></tr></table></figure><h5 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h5><h5 id="安装ntpstat"><a href="#安装ntpstat" class="headerlink" title="安装ntpstat"></a>安装ntpstat</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aptitude install ntpstat -y</span><br></pre></td></tr></table></figure><p>ntpstat 命令查看时间同步状态，这个一般需要5-10分钟后才能成功连接和同步。所以，服务器启动后需要稍等下</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">服务端</span> </span><br><span class="line">ntpstat </span><br><span class="line"><span class="meta">#</span><span class="bash">在第6层同步到NTP服务器，时间在11 毫秒内纠正，每隔64秒轮询一次服务器。</span></span><br><span class="line">synchronised to local net at stratum 6 </span><br><span class="line">   time correct to within 11 ms</span><br><span class="line">   polling server every 64 s</span><br><span class="line"><span class="meta">#</span><span class="bash">客户端</span></span><br><span class="line">ntpstat </span><br><span class="line"><span class="meta">#</span><span class="bash">在第7层同步到NTP服务器，时间在76 毫秒内纠正，每隔64秒轮询一次服务器。</span></span><br><span class="line">synchronised to NTP server (10.10.70.101) at stratum 7 </span><br><span class="line">   time correct to within 76 ms</span><br><span class="line">   polling server every 64 s</span><br><span class="line"></span><br><span class="line">ntpq  -p：此命令可以列出当前主机的NTP和上层NTP的状态。</span><br><span class="line"><span class="meta">#</span><span class="bash">服务端</span></span><br><span class="line">ntpq -p </span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*LOCAL(0)        .LOCL.           5 l    3   64  377    0.000   +0.000   0.000</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">客户端</span></span><br><span class="line">ntpq -p</span><br><span class="line">     remote           refid      st t when poll reach   delay   offset  jitter</span><br><span class="line">==============================================================================</span><br><span class="line">*10.10.70.101    LOCAL(0)         6 u    8   64  377    0.352   -0.658   0.531</span><br></pre></td></tr></table></figure><p>remote：上层NTP服务器的IP或者主机名。主要最左边的*<br>　　*：代表目前正在使用中的上层FTP<br>　　+：已经连接成功，且可以作为下一个提供时间服务的候选人。<br>refid：它指的是给服务器(10.10.70.101)提供时间同步的服务器，本机上级的上级NTP服务器。为什么显示为LOCAL(0)？由于此处为内网环境，无法去外网公用的主机同步时间，因此我们在10.10.70.101上设置的是10.10.70.101自身作为时间服务器同时，使用server 127.127.1.0 prefer指名他的上级NTP为自身。<br>st：就是stratum层级。 类似于DNS，NTP是层级结构,有顶端的服务器，最多有15层。 为了减缓负荷和网络堵塞，原则上应该避免直接连接到级别为1的服务器。<br>when：几秒之前同步过时间<br>poll：在过多长时间去同步时间。<br>reach：已经同步时间的次数<br>delay：网络传输过程中的延迟，单位是10的-6次方秒。<br>offset：时间修正值，这是个最关键的值, 它告诉了我们本地机和服务器之间的时间差别.。单位是10的-3次方。<br>jitter：linux系统时间（软件时间）与BIOS硬件时间的差异时间，单位是10的-6次方秒。在主机和NTP服务器同步时间欧，<br>可以使用 hwclock -w将系统时间写入BIOS.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="cryptsetup" scheme="https://www.hnswxx.cn/tags/cryptsetup/"/>
    
    <category term="Debian11" scheme="https://www.hnswxx.cn/tags/Debian11/"/>
    
  </entry>
  
  <entry>
    <title>debian11 cryptsetup分区加密</title>
    <link href="https://www.hnswxx.cn/2022/02/10/debian11-cryptsetup/"/>
    <id>https://www.hnswxx.cn/2022/02/10/debian11-cryptsetup/</id>
    <published>2022-02-10T08:47:39.000Z</published>
    <updated>2022-02-10T08:59:31.629Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>原理：cryptsetup其实是一种设备的映射关系，我们用它来把一个设备映射成另外一个设备，然后对这个新的设备进行操作，并进行加密，这样就不会使我们的原设备直接被使用，从而达到一种安全的效果。</p><p>对磁盘设置密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup luksFormat /dev/sdb1 </span><br><span class="line">WARNING!</span><br><span class="line">========</span><br><span class="line">This will overwrite data on /dev/sdb1 irrevocably.</span><br><span class="line"></span><br><span class="line">Are you sure? (Type &#x27;yes&#x27; **in** capital letters): YES #必须大写</span><br><span class="line">Enter passphrase **for** /dev/sdb1: #密码 （必须较为复杂）</span><br><span class="line">Verify passphrase: #验证密码</span><br></pre></td></tr></table></figure><p>打开映射（映射到/dev/mapper）</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup luksOpen /dev/sdb1 test_disk</span><br><span class="line">Enter passphrase for /dev/sdb1:  #输入设置的密码</span><br><span class="line"> ll /dev/mapper/</span><br><span class="line">total 0</span><br><span class="line">crw------- 1 root root 10, 236 Jan  6 11:39 control</span><br><span class="line">lrwxrwxrwx 1 root root       7 Jan  6 11:39 debian--vg-root -&gt; ../dm-1</span><br><span class="line">lrwxrwxrwx 1 root root       7 Jan  6 11:39 debian--vg-swap_1 -&gt; ../dm-2</span><br><span class="line">lrwxrwxrwx 1 root root       7 Jan  6 12:25 test_disk -&gt; ../dm-0</span><br></pre></td></tr></table></figure><p>查看映射设备的状态</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cryptsetup status test_disk</span><br><span class="line">/dev/mapper/test_disk is active.</span><br><span class="line">  type:    LUKS2</span><br><span class="line">  cipher:  aes-xts-plain64</span><br><span class="line">  keysize: 512 bits</span><br><span class="line">  key location: keyring</span><br><span class="line">  device:  /dev/sdb1</span><br><span class="line">  sector size:  512</span><br><span class="line">  offset:  32768 sectors</span><br><span class="line">  size:    10450944 sectors</span><br><span class="line">  mode:    read/write</span><br></pre></td></tr></table></figure><p>对映射的设备进行格式化、挂载</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfs.ext4 /dev/mapper/test_disk</span><br></pre></td></tr></table></figure><p>设置开机自动启动</p><p>修改配置文件/etc/crypttab–&gt;加入映射关系</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> &lt;target name&gt; &lt;<span class="built_in">source</span> device&gt;         &lt;key file&gt;      &lt;options&gt;</span></span><br><span class="line">test_disk /dev/sdb1</span><br></pre></td></tr></table></figure><p>设置开机自动挂载</p><p>查看设备UUID</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">blkid /dev/mapper/test_disk </span><br><span class="line">/dev/mapper/test_disk: UUID=&quot;7245214e-cf9b-4cf0-932f-9bac31a61faf&quot; BLOCK_SIZE=&quot;4096&quot; TYPE=&quot;ext4&quot;</span><br></pre></td></tr></table></figure><p>编写开机挂载配置文件</p><p>映射设备名 加密设备 密码文件(为空时表示开机需要手动输入密码) </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/etc/fstab</span><br><span class="line">UUID=&quot;7245214e-cf9b-4cf0-932f-9bac31a61faf&quot; /test   ext4  defaults 0 0</span><br></pre></td></tr></table></figure><p>重启系统<img src="https://s2.loli.net/2022/02/10/vgGU2f1Q7nptq8H.png" alt="image-20220210164124603"></p><p>系统出现输入密码的界面（需要输入磁盘密码方可启动）： </p><p>输入正确密码，查看挂载情况：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">df -Th</span><br><span class="line">Filesystem                  Type      Size  Used Avail Use% Mounted on</span><br><span class="line">udev                        devtmpfs  328M     0  328M   0% /dev</span><br><span class="line">tmpfs                       tmpfs      70M  680K   69M   1% /run</span><br><span class="line">/dev/mapper/debian--vg-root ext4       19G  1.0G   17G   6% /</span><br><span class="line">tmpfs                       tmpfs     346M     0  346M   0% /dev/shm</span><br><span class="line">tmpfs                       tmpfs     5.0M     0  5.0M   0% /run/lock</span><br><span class="line">/dev/sda1                   ext2      470M   49M  397M  11% /boot</span><br><span class="line">/dev/mapper/test_disk       ext4      4.9G   24K  4.6G   1% /test</span><br><span class="line">tmpfs                       tmpfs      70M     0   70M   0% /run/user/0</span><br></pre></td></tr></table></figure><p>设置开机自动输入磁盘密码</p><p>创建密钥文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">touch test_passwd</span><br><span class="line">cryptsetup luksAddKey /dev/sdb1 ./test_passwd </span><br><span class="line">Enter any existing passphrase: #输入磁盘密码</span><br></pre></td></tr></table></figure><p>在配置文件/etc/crypttab中加入密钥文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> &lt;target name&gt; &lt;<span class="built_in">source</span> device&gt;      &lt;key file&gt;   &lt;options&gt;</span></span><br><span class="line">test_disk /dev/sdb1 /root/test_passwd</span><br></pre></td></tr></table></figure><p>此后开机时自动导入密码，不必手动输入密码</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="cryptsetup" scheme="https://www.hnswxx.cn/tags/cryptsetup/"/>
    
    <category term="Debian11" scheme="https://www.hnswxx.cn/tags/Debian11/"/>
    
  </entry>
  
  <entry>
    <title>WindowsServer2019下IIS+PHP配置教程</title>
    <link href="https://www.hnswxx.cn/2021/12/17/windows-iis-php/"/>
    <id>https://www.hnswxx.cn/2021/12/17/windows-iis-php/</id>
    <published>2021-12-17T04:36:10.000Z</published>
    <updated>2021-12-17T04:41:56.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><table><thead><tr><th>Software</th><th>PHP</th><th>IIS</th></tr></thead><tbody><tr><td>Link</td><td><a href="https://windows.php.net/download">PHP For Windows: Binaries and sources Releases</a></td><td><a href="https://www.iis.net/">Home : The Official Microsoft IIS Site</a></td></tr><tr><td>Version</td><td>8.1.1</td><td>10.0</td></tr></tbody></table><ol><li>首先安装WEB服务与应用程序开发功能中的CGI</li></ol><p><a href="https://imgtu.com/i/Tiz0Z8"><img src="https://s4.ax1x.com/2021/12/17/Tiz0Z8.png" alt="Tiz0Z8.png"></a></p><ol start="2"><li>下载PHP </li></ol><p><a href="https://imgtu.com/i/TizOL6"><img src="https://s4.ax1x.com/2021/12/17/TizOL6.png" alt="TizOL6.png"></a></p><p>下载得到 php-8.1.1-nts-Win32-vs16-x64.zip</p><p><a href="https://imgtu.com/i/TFSNY4"><img src="https://s4.ax1x.com/2021/12/17/TFSNY4.png" alt="TFSNY4.png"></a></p><p>解压到当前目录php文件夹下</p><p><a href="https://imgtu.com/i/TFPPN8"><img src="https://s4.ax1x.com/2021/12/17/TFPPN8.png" alt="TFPPN8.png"></a></p><p>找到php.ini-development，改名为php.ini，用文本编辑器打开</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 找到 ; extension_dir = &quot;./&quot; 将前面的；去掉，并替换双引号里的内容为</span></span><br><span class="line"><span class="attr">extension_dir</span> = <span class="string">&quot;C:/php/ext&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2. 找到 ;cgi.force_redirect = 1 去掉; 改为</span></span><br><span class="line"><span class="attr">cgi.force_redirect</span> = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3. 找到 ;cgi.fix_pathinfo=1 去掉前面的；</span></span><br><span class="line"><span class="attr">cgi.fix_pathinfo</span> = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#4. 找到 ;fastcgi.impersonate = 1 去掉前面的；</span></span><br><span class="line"><span class="attr">fastcgi.impersonate</span> = <span class="number">1</span></span><br></pre></td></tr></table></figure><p>修改好的配置文件 点击下载<a href="https://www.lanzoul.com/iDDzbxp2sbe">php.txt - 蓝奏云 (lanzoul.com)</a></p><ol start="3"><li>因为php-8.1.1需要vs16（Visual Studio 2019）的支持，所以我们还要下载vs16 </li></ol><blockquote><p>PS：如何下载VS16请看这篇文章</p></blockquote><p><a href="https://imgtu.com/i/TF9AIS"><img src="https://s4.ax1x.com/2021/12/17/TF9AIS.png" alt="TF9AIS.png"></a></p><p><a href="https://imgtu.com/i/TF9uMn"><img src="https://s4.ax1x.com/2021/12/17/TF9uMn.png" alt="TF9uMn.png"></a></p><p>安装VS16（自动联网下载即可）</p><p><a href="https://imgtu.com/i/TF9heP"><img src="https://s4.ax1x.com/2021/12/17/TF9heP.png" alt="TF9heP.png"></a></p><p>安装成功</p><p><a href="https://imgtu.com/i/TF9xoT"><img src="https://s4.ax1x.com/2021/12/17/TF9xoT.png" alt="TF9xoT.png"></a></p><ol start="4"><li>配置IIS管理器</li></ol><p>打开IIS管理器 并且打开处理程序映射</p><p><a href="https://imgtu.com/i/TFPk9g"><img src="https://s4.ax1x.com/2021/12/17/TFPk9g.png" alt="TFPk9g.png"></a></p><p><strong>点击”处理程序映射“</strong></p><p><a href="https://imgtu.com/i/TFPnH0"><img src="https://s4.ax1x.com/2021/12/17/TFPnH0.png" alt="TFPnH0.png"></a></p><p><strong>点击”添加模块映射“</strong></p><p><a href="https://imgtu.com/i/TFPcDI"><img src="https://s4.ax1x.com/2021/12/17/TFPcDI.png" alt="TFPcDI.png"></a></p><ol start="5"><li>测试</li></ol><p><a href="https://imgtu.com/i/TFFmkV"><img src="https://s4.ax1x.com/2021/12/17/TFFmkV.png" alt="TFFmkV.png"></a></p><p>修改默认网站</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除默认网站下的默认网页文件，创建文件index.php，文件内容如下</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> phpinfo();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/TFFcAP"><img src="https://s4.ax1x.com/2021/12/17/TFFcAP.png" alt="TFFcAP.png"></a></p><p>用浏览器进行浏览测试</p><p><a href="https://imgtu.com/i/TFFX3F"><img src="https://s4.ax1x.com/2021/12/17/TFFX3F.png" alt="TFFX3F.png"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Windows" scheme="https://www.hnswxx.cn/categories/Windows/"/>
    
    
    <category term="WindowServer2019" scheme="https://www.hnswxx.cn/tags/WindowServer2019/"/>
    
    <category term="PHP" scheme="https://www.hnswxx.cn/tags/PHP/"/>
    
    <category term="IIS" scheme="https://www.hnswxx.cn/tags/IIS/"/>
    
  </entry>
  
  <entry>
    <title>PHP版本Non Thread Safe和Thread Safe如何选择？区别是什么？</title>
    <link href="https://www.hnswxx.cn/2021/12/17/php-thread-safe-difference/"/>
    <id>https://www.hnswxx.cn/2021/12/17/php-thread-safe-difference/</id>
    <published>2021-12-17T03:03:38.000Z</published>
    <updated>2021-12-17T03:11:40.515Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>PHP版本分为Non Thread Safe和Thread Safe，Non Thread Safe是指非线程安全，Thread Safe是指线程安全，区别是什么？如何选择？</p><p><a href="https://imgtu.com/i/TiLPbQ"><img src="https://s4.ax1x.com/2021/12/17/TiLPbQ.png" alt="TiLPbQ.png"></a></p><p><strong>Non Thread Safe和Thread Safe的区别</strong></p><ul><li>ts(Thread-Safety)即线程安全，多线程访问时，采用了加锁机制，当一个线程访问该类的某个数据时，进行保护，其他线程不能进行访问直到该线程读取完，其他线程才可使用。不会出现数据不一致或者数据污染php以ISAPI方式加载的时候选择这个版本.，php以ISAPI方式加载的时候选择这个版本.</li><li>nts(None-Thread Safe)即非线程安全，就是不提供数据访问保护，有可能出现多个线程先后更改数据造成所得到的是 脏数据php以fast cgi方式运行的时候选择这个版本，具有更好的性能；</li><li>ISAPI(Internet Server Application Programming Interface), 通常是指被http服务器所加载，以服务器的模块形式运行，由微 软提出，故只能在win平台上运行，例如win下的apache,iis[据说用fast cgi 方式工作更稳定]，而linux上php 则以 Apache模块或者php-fpm的方式运行。</li><li>cgi(Common Gateway Interface):HTTP服务器与你的或其它机器上的程序进行“交谈”的一种工具,说白了，cig就是一种 后台语言，其可以和服务器之间进行通讯。此时的php是作为一个独立的程序运行的。特点就是耗费内存。</li><li>fast cgi.是一个常驻(long-live)型的CGI，它可以一直执行着，只要激活后，不会每次都要花费时间去fork.这种方式 是与语言无关的、可伸缩架构的CGI开放扩展，其主要行为是将CGI解释器进程保持在内存中并因此获得较 高的性能。</li></ul><p>ISAPI执行方式是以DLL动态库的形式使用，可以在被用户请求后执行，在处理完一个用户请求后不会马上消失，所以需要进行线程安全检查，这样来提高程序的执行效率，所以如果是以ISAPI来执行PHP，建议选择ThreadSafe版本。</p><p>而FastCGI执行方式是以单一线程来执行操作，所以不需要进行线程的安全检查，除去线程安全检查的防护反而可以提高执行效率，所以，如果是以FastCGI来执行PHP，建议选择NonThread Safe版本。</p><p>那么，如何查看当前PHP到底是Non Thread Safe（非线程安全）还是Thread Safe（线程安全）？</p><p>很简单，打印phpinfo()，查看PHP版本信息中的Thread Safety选项，此选项为enable，就是Thread Safe（线程安全）版本，否则就是None Thread Safe（非线程安全）版本。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="PHP" scheme="https://www.hnswxx.cn/tags/PHP/"/>
    
  </entry>
  
  <entry>
    <title>记录一次IPAD  air降级ios10.3.3的全部过程</title>
    <link href="https://www.hnswxx.cn/2021/12/15/ipadair_downgrade/"/>
    <id>https://www.hnswxx.cn/2021/12/15/ipadair_downgrade/</id>
    <published>2021-12-14T16:51:24.000Z</published>
    <updated>2021-12-14T16:57:02.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h4><p>我在闲鱼上淘到一个350块钱的IPAD AIR，是一台14年的老机器。成色从外观上看还算新，只有屏幕右上角有明显的磕碰，其他并没有明显的损坏，爱思助手上的具体参数是这样的。</p><p><a href="https://imgtu.com/i/oxgqFP"><img src="https://s4.ax1x.com/2021/12/14/oxgqFP.png" alt="oxgqFP.png"></a></p><p>到货了以后发现后置摄像头有损坏，无法正常使用。商家又给我退了30块钱，最终这个ipad air我拿到手花了320块钱。</p><p>这是我第一次使用IOS系统，虽然这台IPAD 还没有更新最新的IOS系统12.5.5，但是我在使用上也是奇卡无比，感觉不能流程的玩耍了，于是乎在我经过一段时间的百度以后，我想到了给我的IPAD 降级。</p><p>IPAD 外观照片</p><p>（正面照）</p><p><a href="https://imgtu.com/i/ox43sU"><img src="https://s4.ax1x.com/2021/12/14/ox43sU.jpg" alt="ox43sU.jpg"></a></p><p>（反面照）反面具体有一些小磨损，但是并不碍事，套上一个壳子就好了。</p><p><a href="https://imgtu.com/i/ox59w4"><img src="https://s4.ax1x.com/2021/12/14/ox59w4.md.jpg" alt="ox59w4.md.jpg"></a></p><p>（从拼多多定制的IPAD壳子）</p><p><a href="https://imgtu.com/i/ox5KTH"><img src="https://s4.ax1x.com/2021/12/14/ox5KTH.md.png" alt="ox5KTH.md.png"></a></p><h4 id="经过"><a href="#经过" class="headerlink" title="经过"></a>经过</h4><blockquote><p><strong>首先这是一个痛苦的过程</strong></p></blockquote><p>据我在b站和百度的找寻结果中看，如果你想降级，首先你得有一个mac系统的电脑或者你自己装一个黑苹果，使用vmware虚拟机还不行。</p><p>这就很为难我了，我从哪里找一台mac系统的电脑呢？于是我准备给我的台式机刷一个黑苹果，但是我打开大师一看，卧槽？硬盘竟然是三星的pm981a，因为我在国光的博客上看到三星pm981a装黑苹果比较坑，我一个第一次接触mac的人我肯定是果断放弃了，于是乎我就在自己的笔记本上折腾了起来，我的笔记本是老版拯救者r720 配置是i57300hq 12g内存 128固态+1t机械 ，然后我研究了一天终于把我的黑苹果装上去了，具体详细操作我就不写了因为我也没太整明白，反正就是装上了，最后还把我的Windows搞没了，简直把我气死，装的是黑果小兵官网上的macOS Mojave 10.14.6 </p><p>[【黑果小兵】macOS Mojave 10.14.6 18G103 正式版 with Clover 5091原版镜像<a href="https://blog.daliansky.net/macOS-Mojave-10.14.6-18G87-Release-version-with-Clover-5033-original-image.html">双EFI双平台终极版] | 黑果小兵的部落阁 (daliansky.net)</a></p><p><a href="https://imgtu.com/i/oxo1QP"><img src="https://s4.ax1x.com/2021/12/14/oxo1QP.png" alt="oxo1QP.png"></a></p><p>（安装完以后的拯救者r720）</p><p><a href="https://imgtu.com/i/oxoDyV"><img src="https://s4.ax1x.com/2021/12/14/oxoDyV.jpg" alt="oxoDyV.jpg"></a></p><p>（结果Windows 进不去了 我太难了）</p><p><a href="https://imgtu.com/i/oxoOfA"><img src="https://s4.ax1x.com/2021/12/14/oxoOfA.png" alt="oxoOfA.png"></a></p><p><strong>开始正题，此次环境介绍</strong></p><ul><li><p>硬件</p><ul><li>笔记本 联想拯救者r720 硬件配置（i5 7300hq 12g内存 128g固态+1t机械）</li><li>iPad air  产品类型 iPad4,1 (A1474)  硬件配置 （Apple A7 16G）</li></ul></li><li><p>系统</p><ul><li>笔记本 macOS Mojave 10.14.6</li><li>iPad IOS 12.5.4</li></ul></li><li><p>软件（以下软件均装在电脑下）</p></li></ul><table><thead><tr><th></th><th>爱思助手</th><th>vieux</th><th>python</th></tr></thead><tbody><tr><td>版本</td><td>无所谓</td><td>无所谓</td><td>3.5</td></tr><tr><td>链接</td><td><a href="https://www.i4.cn/">爱思助手官网</a></td><td><a href="https://github.com/MatthewPierson/Vieux">vieux</a></td><td><a href="https://www.python.org/ftp/python/3.5.0/python-3.5.0-macosx10.6.pkg">installer</a></td></tr></tbody></table><p><strong>降级步骤（主要是mac的操作）</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">首先下载MathewPierso大佬的vieux (https://github.com/MatthewPierson/Vieux)</span><br><span class="line"></span><br><span class="line">在mac的桌面上运行 git clone https://github.com/MatthewPierson/Vieux.git</span><br><span class="line">PS: 如果没有git 可以使用appstore 安装一个git</span><br><span class="line"></span><br><span class="line">从python的官网上下载python3.5！并且进行安装</span><br><span class="line">https://www.python.org/ftp/python/3.5.0/python-3.5.0-macosx10.6.pkg</span><br><span class="line">PS: 只能是3.5其他版本好像不行。</span><br><span class="line"></span><br><span class="line">从爱思官网下载最新版的爱思助手，并且安装</span><br><span class="line">从爱思助手上下载iPad对应的10.3.3的系统固件 </span><br><span class="line">PS: 下载这个14G60的 我用14G58的试了试好像不行</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/oxLLtS"><img src="https://s4.ax1x.com/2021/12/15/oxLLtS.png" alt="oxLLtS.png"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">下载好固件以后把固件放到vieux的文件夹里</span><br><span class="line">vieux 下载好里面会有这些文件</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/oxOltO"><img src="https://s4.ax1x.com/2021/12/15/oxOltO.png" alt="oxOltO.png"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这些准备好以后，把设备进入DFU模式</span><br><span class="line">PS：将设备进入DFU模式。DFU模式不是恢复模式！DFU模式不是恢复模式！DFU模式不是恢复模式！DFU模式设备应当是完全黑屏的，如果是有iTunes图标与线，那就是恢复模式！这一步我个人认为是整个过程中最难的一步，因为经常会出现进入不了DFU模式的情况，可能浪费大把时间。</span><br></pre></td></tr></table></figure><p>摸索之下，进入DFU的最好方法是：</p><ul><li>在设备插入电脑的情况下关机。</li><li>确认关机后，<strong>同时按住电源键与Home键</strong>，<strong>闭上眼睛</strong>，<strong>默数10秒</strong>，<strong>松开电源键</strong>。</li><li>在电脑上打开的爱思助手里确认设备进入了DFU模式。使用这种方法进入DFU的成功率接近100%。</li></ul><p>以下是我进入DFU模式的截图</p><p><a href="https://imgtu.com/i/oxXzd0"><img src="https://s4.ax1x.com/2021/12/15/oxXzd0.png" alt="oxXzd0.png"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">在终端执行</span><br><span class="line">pip3 install -r &quot;requirements.txt&quot;</span><br><span class="line">来我们会用到的依赖</span><br><span class="line">PS:安装时确认没有任何红色的报错以后</span><br><span class="line">正式开始降级！！！</span><br><span class="line">在终端执行</span><br><span class="line">python3 vieux -i 跟上固件文件</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/oxjLtK"><img src="https://s4.ax1x.com/2021/12/15/oxjLtK.jpg" alt="oxjLtK.jpg"></a></p><p>然后就会自动的去降级，但是不一定百分百成功，网上是这么说的</p><p><a href="https://imgtu.com/i/oxvaH1"><img src="https://s4.ax1x.com/2021/12/15/oxvaH1.png" alt="oxvaH1.png"></a></p><h4 id="结果"><a href="#结果" class="headerlink" title="结果"></a>结果</h4><p>可能是因为我运气比较好吧，我第二次就降级成功了，以下是我降级时候的照片</p><p><a href="https://imgtu.com/i/oxvRHI"><img src="https://s4.ax1x.com/2021/12/15/oxvRHI.png" alt="oxvRHI.png"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    
    <category term="瞎搞机" scheme="https://www.hnswxx.cn/tags/%E7%9E%8E%E6%90%9E%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>ldap基础配置与案例</title>
    <link href="https://www.hnswxx.cn/2021/12/11/ldap-basic-configuration/"/>
    <id>https://www.hnswxx.cn/2021/12/11/ldap-basic-configuration/</id>
    <published>2021-12-11T12:35:16.000Z</published>
    <updated>2021-12-11T12:57:19.556Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="ldap案例"><a href="#ldap案例" class="headerlink" title="ldap案例"></a>ldap案例</h4><p>配置 ldc 为 Linux 端的域控制器，使用 LDAP 作为统一认证服务，启用 SSL 模式，只允许 使用域名的方式访问 LDAP，集成 Kerberos 的方式作为认证中心，域名为 bigone.com， 并且建立用户 linuxadmin 作为管理用户；</p><p>在 ldc 的 LDAP 上创建组织单位和用户组，采用对应部门名称的中文全拼命名，每个组创 建 2 个用户，人力部用户：hr1~hr2、营销部用户：sale1 sale2、财务部用户：fin1 fin2； 技术部用户：te1 te2。</p><h4 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装关于openldap相关的软件包</span></span><br><span class="line">yum install -y openldap openldap-clients openldap-servers migrationtools</span><br><span class="line"><span class="meta">#</span><span class="bash">创建管理用户linuxadmin</span> </span><br><span class="line">useradd linuxadmin</span><br><span class="line"><span class="meta">#</span><span class="bash">生成密钥文件（记下生成出的值，后面要用）：</span></span><br><span class="line">slappasswd -s linuxadmin -n &gt; /etc/openldap/passwd</span><br><span class="line">cat /etc/openldap/passwd </span><br><span class="line">&#123;SSHA&#125;+J7U5ufZH/nm4Svs/VMMWmabVPNoi5ll</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">根据题目创建证书文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">因为LDAP目录服务是以明文的方式在网络中传输数据的（包括密码），这样真的很不安全，所以我们采用TLS加密机制来解决这个问题，使用openssl工具生成X509格式的证书文件：</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入ldap证书文件夹</span></span><br><span class="line">cd /etc/openldap/certs/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建自签名证书</span></span><br><span class="line">openssl req -new -x509 -nodes -out /etc/openldap/certs/cert.pem -keyout /etc/openldap/certs/priv.pem -days 365</span><br><span class="line">Generating a 2048 bit RSA private key</span><br><span class="line">..........................................+++</span><br><span class="line">..............................................................+++</span><br><span class="line">writing new private key to &#x27;/etc/openldap/certs/priv.pem&#x27;</span><br><span class="line">-----</span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:GuangDong</span><br><span class="line">Locality Name (eg, city) [Default City]:GuangZhou</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:skillsjnds</span><br><span class="line">Organizational Unit Name (eg, section) []:system</span><br><span class="line">Common Name (eg, your name or your server hostname) []:ldc.bigone.com</span><br><span class="line">Email Address []:敲击回车</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改证书的所属与权限</span></span><br><span class="line">chown ldap:ldap *</span><br><span class="line">chmod 600 *</span><br><span class="line">total 100</span><br><span class="line">-rw-------. 1 ldap ldap  1021 Dec  3 08:20 ca.csr</span><br><span class="line">-rw-------. 1 ldap ldap 65536 Dec  3 08:14 cert8.db</span><br><span class="line">-rw-------. 1 ldap ldap  4478 Dec  3 08:20 cert.pem</span><br><span class="line">-rw-------. 1 ldap ldap 16384 Dec  3 08:14 key3.db</span><br><span class="line">-rw-------. 1 ldap ldap    45 Dec  2 21:29 password</span><br><span class="line">-rw-------. 1 ldap ldap  1675 Dec  3 08:17 priv.pem</span><br><span class="line">-rw-------. 1 ldap ldap 16384 Dec  2 21:29 secmod.db</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">复制一份LDAP的配置模板</span></span><br><span class="line">cp /usr/share/openldap-servers/DB_CONFIG.example /var/lib/ldap/DB_CONFIG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">生成数据库文件（不用担心报错信息）：</span></span><br><span class="line">slaptest </span><br><span class="line">61a96371 hdb_db_open: database &quot;dc=my-domain,dc=com&quot;: db_open(/var/lib/ldap/id2entry.bdb) failed: No.</span><br><span class="line">61a96371 backend_startup_one (type=hdb, suffix=&quot;dc=my-domain,dc=com&quot;): bi_db_open failed! (2)</span><br><span class="line">slap_startup failed (test would succeed using the -u switch)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">修改LDAP数据库的所属主与组：</span></span><br><span class="line">chown ldap:ldap /var/lib/ldap/*</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动sladp服务程序并设置为开机启动</span></span><br><span class="line">systemctl restart slapd.service</span><br><span class="line">systemctl enable slapd.service </span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/slapd.service to /usr/lib/systemd/s.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在LDAP目录服务中使用<strong>LDIF</strong>(LDAP <strong>I</strong>nterchange <strong>F</strong>ormat)格式来保存信息，而LDIF是一种标准的文本文件且可以随意的导入导出，所以我们需要有一种“格式”标准化LDIF文件的写法，这中格式叫做“schema”，schema用于指定一个目录中所包含对象的类型，以及每一个类型中的可选属性，我们可以将schema理解为面向对象程序设计中的“类”，通过“类”定义出具体的对象，因此其实LDIF数据条目则都是通过schema数据模型创建出来的具体对象：</p><p><strong>ldapadd<a href="https://www.linuxcool.com/">命令</a>用于将LDIF文件导入到目录服务数据库中，格式为：“ldapadd [参数] LDIF文件”。</strong></p><table><thead><tr><th>参数</th><th>作用</th></tr></thead><tbody><tr><td>-x</td><td>进行简单认证。</td></tr><tr><td>-D</td><td>用于绑定服务器的dn。</td></tr><tr><td>-h：</td><td>目录服务的地址。</td></tr><tr><td>-w：</td><td>绑定dn的密码。</td></tr><tr><td>-f：</td><td>使用LDIF文件进行条目添加的文件。</td></tr></tbody></table><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加cosine和nis模块：</span></span><br><span class="line"><span class="built_in">cd</span> /etc/openldap/schema/</span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -D <span class="string">&quot;cn=config&quot;</span> -f cosine.ldif</span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">&quot;cn=cosine,cn=schema,cn=config&quot;</span></span><br><span class="line"></span><br><span class="line">ldapadd -Y EXTERNAL -H ldapi:/// -D <span class="string">&quot;cn=config&quot;</span> -f nis.ldif</span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">adding new entry <span class="string">&quot;cn=nis,cn=schema,cn=config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建/etc/openldap/changes.ldif文件，并将下面的信息复制进去：（注意有一处要修改的地方）</span></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcSuffix</span><br><span class="line">olcSuffix: dc=bigone,dc=com</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootDN</span><br><span class="line">olcRootDN: cn=linuxadmin,dc=bigone,dc=com</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;2&#125;hdb,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcRootPW</span><br><span class="line">olcRootPW: 此处输入之前生成的密码（如&#123;SSHA&#125;v/GJvGG8SbIuCxhfTDVhkmWEuz2afNIR）</span><br><span class="line"></span><br><span class="line">dn: cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcTLSCertificateFile</span><br><span class="line">olcTLSCertificateFile: /etc/openldap/certs/cert.pem</span><br><span class="line"></span><br><span class="line">dn: cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcTLSCertificateKeyFile</span><br><span class="line">olcTLSCertificateKeyFile: /etc/openldap/certs/priv.pem</span><br><span class="line"></span><br><span class="line">dn: cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcLogLevel</span><br><span class="line">olcLogLevel: -1</span><br><span class="line"></span><br><span class="line">dn: olcDatabase=&#123;1&#125;monitor,cn=config</span><br><span class="line">changetype: modify</span><br><span class="line">replace: olcAccess</span><br><span class="line">olcAccess: &#123;0&#125;to * by dn.base=<span class="string">&quot;gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth&quot;</span> <span class="built_in">read</span> by dn.base=<span class="string">&quot;cn=linuxadmin,dc=bigone,dc=com&quot;</span> <span class="built_in">read</span> by * none</span><br><span class="line"></span><br><span class="line"><span class="comment">#将新的配置文件更新到slapd服务程序：</span></span><br><span class="line">ldapmodify -Y EXTERNAL -H ldapi:/// -f /etc/openldap/changes.ldif</span><br><span class="line">SASL/EXTERNAL authentication started</span><br><span class="line">SASL username: gidNumber=0+uidNumber=0,cn=peercred,cn=external,cn=auth</span><br><span class="line">SASL SSF: 0</span><br><span class="line">modifying entry <span class="string">&quot;olcDatabase=&#123;2&#125;hdb,cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;olcDatabase=&#123;2&#125;hdb,cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;olcDatabase=&#123;2&#125;hdb,cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;cn=config&quot;</span></span><br><span class="line">modifying entry <span class="string">&quot;olcDatabase=&#123;1&#125;monitor,cn=config&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#创建/etc/openldap/base.ldif文件，并将下面的信息复制进去：</span></span><br><span class="line">dn: dc=bigone,dc=com</span><br><span class="line">dc: bigone</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: domain</span><br><span class="line"></span><br><span class="line">dn: ou=renlibu,dc=bigone,dc=com</span><br><span class="line">ou: renlibu</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line">dn: ou=yingxiaobu,dc=bigone,dc=com</span><br><span class="line">ou: yingxiaobu</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line">dn: ou=caiwubu,dc=bigone,dc=com</span><br><span class="line">ou: caiwubu</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line">dn: ou=jishubu,dc=bigone,dc=com</span><br><span class="line">ou: jishubu</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: organizationalUnit</span><br><span class="line"></span><br><span class="line"><span class="comment">#创建目录的结构服务：</span></span><br><span class="line"><span class="comment">#创建组织单元</span></span><br><span class="line"></span><br><span class="line">ldapadd -x -w linuxadmin -D cn=linuxadmin,dc=bigone,dc=com -f /etc/openldap/base.ldif</span><br><span class="line">adding new entry <span class="string">&quot;dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;ou=renlibu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;ou=yingxiaobu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;ou=caiwubu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;ou=jishubu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;ou=admin,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在本机上创建对应的用户和组</span></span><br><span class="line">groupadd renlibu;groupadd yingxiaobu;groupadd caiwubu;groupadd jishubu;groupadd admin</span><br><span class="line"><span class="comment">#创建对应的用户并且设置到组</span></span><br><span class="line">useradd hr1 -g renlibu;useradd hr2 -g renlibu</span><br><span class="line">useradd sale1 -g yingxiaobu;useradd sale2 -g yingxiaobu</span><br><span class="line">useradd fin1 -g caiwubu;useradd fin2 -g caiwubu</span><br><span class="line">useradd te1 -g jishubu;useradd te2 -g jishubu</span><br><span class="line"></span><br><span class="line"><span class="comment">#更改linuxadmin的组为admin</span></span><br><span class="line">usermod linuxadmin -g admin</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置帐户的迁移（修改第71与74行）：</span></span><br><span class="line">/usr/share/migrationtools/migrate_common.ph</span><br><span class="line"><span class="variable">$DEFAULT_MAIL_DOMAIN</span> = <span class="string">&quot;bigone.com&quot;</span>;</span><br><span class="line"><span class="variable">$DEFAULT_BASE</span> = <span class="string">&quot;dc=bigone,dc=com&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#将当前系统中的用户迁移至目录服务：只演示财务部的</span></span><br><span class="line"> <span class="built_in">cd</span> /usr/share/migrationtools/</span><br><span class="line"><span class="comment">#过略出renlibu部的用户</span></span><br><span class="line">cat /etc/passwd | grep hr | grep home</span><br><span class="line"><span class="comment">#将这些用户导出到caiwuuser下</span></span><br><span class="line">cat /etc/passwd | grep hr | grep home &gt; caiwuuser</span><br><span class="line"><span class="comment">#将财务部的用户变成ldif格式</span></span><br><span class="line">./migrate_passwd.pl caiwuuser caiwuuser.ldif</span><br><span class="line"><span class="comment">#修改该ldif文件里面的用户组织单元为caiwubu ou组织单元</span></span><br><span class="line">dn: uid=hr1,ou=caiwubu,dc=bigone,dc=com <span class="comment">#修改</span></span><br><span class="line">uid: hr1 </span><br><span class="line">cn: hr1 </span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top </span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;!!</span><br><span class="line">shadowLastChange: 18964</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1001</span><br><span class="line">gidNumber: 1001</span><br><span class="line">homeDirectory: /home/hr1</span><br><span class="line"></span><br><span class="line">dn: uid=hr2,ou=caiwubu,dc=bigone,dc=com <span class="comment">#修改</span></span><br><span class="line">uid: hr2 </span><br><span class="line">cn: hr2 </span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top </span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword: &#123;crypt&#125;!!</span><br><span class="line">shadowLastChange: 18964</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1002</span><br><span class="line">gidNumber: 1001</span><br><span class="line">homeDirectory: /home/hr2</span><br><span class="line"></span><br><span class="line"><span class="comment">#导入到目录里</span></span><br><span class="line">ldapadd -x -w linuxadmin -D cn=linuxadmin,dc=bigone,dc=com -f caiwuuser.ldif </span><br><span class="line">adding new entry <span class="string">&quot;uid=hr1,ou=caiwubu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line">adding new entry <span class="string">&quot;uid=hr2,ou=caiwubu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#过略出财务部组</span></span><br><span class="line">cat /etc/group | grep caiwubu &gt; caiwugroup</span><br><span class="line"><span class="comment">#将财务部组用户变成ldif格式</span></span><br><span class="line">./migrate_group.pl caiwugroup caiwugroup.ldif</span><br><span class="line"><span class="comment">#修改该ldif文件里面的组的组织单元为caiwubu ou组织单元 ou=caiwubu</span></span><br><span class="line">dn: cn=caiwubu,ou=caiwubu,dc=bigone,dc=com <span class="comment">#修改</span></span><br><span class="line">objectClass: posixGroup</span><br><span class="line">objectClass: top </span><br><span class="line">cn: caiwubu</span><br><span class="line">userPassword: &#123;crypt&#125;x</span><br><span class="line">gidNumber: 1003</span><br><span class="line"><span class="comment">#导入到目录中</span></span><br><span class="line">ldapadd -x -w linuxadmin -D cn=linuxadmin,dc=bigone,dc=com -f caiwugroup.ldif </span><br><span class="line">adding new entry <span class="string">&quot;cn=caiwubu,ou=caiwubu,dc=bigone,dc=com&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查询用户</span></span><br><span class="line">ldapsearch -x cn=fin1 -b dc=bigone,dc=com</span><br><span class="line"><span class="comment"># extended LDIF</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># LDAPv3</span></span><br><span class="line"><span class="comment"># base &lt;dc=bigone,dc=com&gt; with scope subtree</span></span><br><span class="line"><span class="comment"># filter: cn=fin1</span></span><br><span class="line"><span class="comment"># requesting: ALL</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># fin1, caiwubu, bigone.com</span></span><br><span class="line">dn: uid=fin1,ou=caiwubu,dc=bigone,dc=com</span><br><span class="line">uid: fin1</span><br><span class="line">cn: fin1</span><br><span class="line">objectClass: account</span><br><span class="line">objectClass: posixAccount</span><br><span class="line">objectClass: top</span><br><span class="line">objectClass: shadowAccount</span><br><span class="line">userPassword:: e2NyeXB0fSEh</span><br><span class="line">shadowLastChange: 18964</span><br><span class="line">shadowMin: 0</span><br><span class="line">shadowMax: 99999</span><br><span class="line">shadowWarning: 7</span><br><span class="line">loginShell: /bin/bash</span><br><span class="line">uidNumber: 1005</span><br><span class="line">gidNumber: 1003</span><br><span class="line">homeDirectory: /home/fin1</span><br><span class="line"></span><br><span class="line"><span class="comment"># search result</span></span><br><span class="line">search: 2</span><br><span class="line">result: 0 Success</span><br><span class="line"></span><br><span class="line"><span class="comment"># numResponses: 2</span></span><br><span class="line"><span class="comment"># numEntries: 1</span></span><br></pre></td></tr></table></figure><h4 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装ldap客户端软件</span></span><br><span class="line">yum install openldap-clients nss-pam-ldapd authconfig-gtk pam_krb5 -y</span><br><span class="line"><span class="comment">#把证书考入ldap客户端的证书存放目录</span></span><br><span class="line">/etc/openldap/cacerts</span><br><span class="line">-rw-r--r--. 1 root root 1285 Dec  3 14:25 cert.pem</span><br><span class="line"><span class="comment">#然后打开authconfig-tui</span></span><br><span class="line">authconfig-tui</span><br></pre></td></tr></table></figure><p>选择使用LDAP</p><p><a href="https://imgtu.com/i/o7bmUP"><img src="https://s4.ax1x.com/2021/12/11/o7bmUP.png" alt="o7bmUP.png"></a></p><p>点击下一步 NEXT</p><p>选择Use TLS 输入ldap服务器信息 点击ok过后就完成客户端配置了</p><p><a href="https://imgtu.com/i/o7btU0"><img src="https://s4.ax1x.com/2021/12/11/o7btU0.png" alt="o7btU0.png"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos7" scheme="https://www.hnswxx.cn/tags/Centos7/"/>
    
    <category term="ldap" scheme="https://www.hnswxx.cn/tags/ldap/"/>
    
  </entry>
  
  <entry>
    <title>掌握Windows Server 2012 网卡聚合（NIC Teaming）</title>
    <link href="https://www.hnswxx.cn/2021/12/11/nic-teaming/"/>
    <id>https://www.hnswxx.cn/2021/12/11/nic-teaming/</id>
    <published>2021-12-11T01:08:37.000Z</published>
    <updated>2021-12-11T01:21:02.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Windows Server 2012的推出被称为“云操作系统“，想必这个操作系统在虚拟化领域，在网络和存储层面，在接入和安全层面都会有很有实力的功能体现。今天给大家介绍的网卡聚合能力就是充分利用汇总方式提高服务器整体网络性能，进而实现在高密度业务负载环境，高可用网络环境下的需求，当然除了网卡聚合功能单方面提升消除CPU的瓶颈也是重点，例如Offload卡，SRIOV, RSS，VMQ队列等等技术在Server 2012中你都能找到配套的核心技术支撑。今天这篇博客重点介绍一下Windows Server 2012中网卡聚合的功能。</p><p>说到网卡聚合，可能大家并不陌生，而且这个在”虚拟化世界“里尤为重要的功能，原来Windows Server 2008 R2中并不能提供支持，而是需要依靠HP，DELL，Intel，Broadcom等公司自己提供的软件进行设置和支持，但是这是不够的，要知道通过一个硬件厂商提供的聚合功能软件仅能对同种品牌的网卡进行统一的支持，这对于一个要求具有更多选择权和灵活性的数据中心而言是不够好的。当然你知道的，在Windows Server 2012中我们苦等的内置的，虚拟化环境所依赖的功能终于实现了在操作系统中的预置；因此充分了解合理利用这个功能是十分有益的。</p><p>那么什么是网络聚合或者Windows Server 2012中定义的网络聚合？在Server 2012中网络聚合有种称谓叫做LBOF（Load Balance and failover)字面上也很好理解，就是负载均衡同时实现故障切换功能的网络通道，熟悉这个LBOF灰常有意义，因为实现和查看网卡聚合状态需要用到的Powershell CMDLET就涉及了这个词汇；有了这个操作系统层面的功能，就可以将不同品牌的同质的网卡进行组合实现：</p><ol><li><p>网络带宽捆绑</p></li><li><p>当网络组件出现故障时可以被检测到并自动进行故障转移</p></li></ol><p>举例来说如果你不是配置成“主备”模式而是“双活”模式的网卡聚合，那么两个1GbE的千兆网卡可以实现2Gb的总吞吐，如果是两个万兆网卡就可以实现20Gb的总吞吐以此类推。<strong>Windows Server 2012支持多少个网卡进行捆绑呢？答案是32个！这是个绝对足够大的带宽：</strong></p><p> <a href="https://imgtu.com/i/oTpAiR"><img src="https://s1.ax1x.com/2021/12/11/oTpAiR.png" alt="oTpAiR.png"></a></p><p>Server 2012支持两种网络聚合模式，在配置网络聚合的时候默认的是选择第一种模式：</p><ol><li><p>交换机独立模式<br>这种模式最为通用，因为不要求交换机参与网络聚合，因此交换机并不知道在聚合网络中的网卡属于主机中一个网卡聚合组，所以网卡可以连接不同的交换机不过交换机独立模式并不要求聚合组中的网卡连接到不同的交换机。而且在连接不同交换机时采用的是主备模式，只有在连接在同一交换机时才可以实现负载均衡聚。</p></li><li><p>交换机依赖模式<br>这种模式需要交换机参与网络聚合，并且要求所有网络聚合组网卡连接到同一个物理交换机或者以级联多交换机方式实现的对外显示为单一物理交换机的方式；根据交换机支持的模式可以有两种模式选择：</p></li></ol><ul><li><p>通用的静态聚合模式即IEEE 802.3ad<br>这种模式需要在交换机上静态设置指定汇聚组中的网卡连接。由于这种方式需要静态指定，因此没有动态协商协议机制帮助交换机判断线缆连接的正确与否或是否有其他错误导致聚合失败。</p></li><li><p>动态聚合模式即IEEE 802.1ax或LACP（Link Aggregation Control Protocol 链路汇聚控制协议）<br>这种模式由于有了LACP协议的支持，可以动态的识别服务器和交换机的连接，进而实现动态地创建聚合组，添加和移除组成员等工作，现在多数交换机都支持LACP即802.1ax协议，不过也大多需要在服务器连接的交换机端口中手工启用此功能。</p></li></ul><p>通过图形方法配置，如果在Server 2012中启用了图形界面管理功能，可以利用服务器管理器简单的创建网络聚合。</p><p><a href="https://imgtu.com/i/oTp2OU"><img src="https://s1.ax1x.com/2021/12/11/oTp2OU.png" alt="oTp2OU.png"></a></p><p>当然，通过Powershell命令行是个很好的方式，先看看可以针对LBFO进行哪些操作：</p><p><a href="https://imgtu.com/i/oTphTJ"><img src="https://s1.ax1x.com/2021/12/11/oTphTJ.png" alt="oTphTJ.png"></a></p><p>创建一个网卡聚合组“NIC Teaming”，将所有本机物理网卡添加到这个组中，并且设置模式为交换机独立模式，负载均衡模式为默认哈希：</p><p><a href="https://imgtu.com/i/oTpof1"><img src="https://s1.ax1x.com/2021/12/11/oTpof1.png" alt="oTpof1.png"></a></p><p>看看创建之后的网络设备，是不是多了一个NIC Teaming网卡？</p><p><a href="https://imgtu.com/i/oTp7Sx"><img src="https://s1.ax1x.com/2021/12/11/oTp7Sx.png" alt="oTp7Sx.png"></a></p><p>当然，你也可以通过Powershell看到这个网络聚合网卡的状态：</p><p><a href="https://imgtu.com/i/oTpHl6"><img src="https://s1.ax1x.com/2021/12/11/oTpHl6.png" alt="oTpHl6.png"></a></p><p>本博客至此，你可能觉得还不过瘾啊，毕竟涉及类似负载均衡策略等很多方面都没涉及到，没关系；我在网上看到一个涉及网卡聚合方方面面的详尽文档，不敢独享这里分享给大家，感兴趣的别忘了收集哦：）</p><p><a href="http://www.microsoft.com/en-us/download/details.aspx?id=30160"> Windows Server 2012 NIC Teaming (LBFO) Deployment and Management</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Windows" scheme="https://www.hnswxx.cn/categories/Windows/"/>
    
    
    <category term="WindowServer2019" scheme="https://www.hnswxx.cn/tags/WindowServer2019/"/>
    
    <category term="nic" scheme="https://www.hnswxx.cn/tags/nic/"/>
    
  </entry>
  
  <entry>
    <title>centos8网关服务器（防火墙的nat转换）</title>
    <link href="https://www.hnswxx.cn/2021/12/10/centos8-gateway-server/"/>
    <id>https://www.hnswxx.cn/2021/12/10/centos8-gateway-server/</id>
    <published>2021-12-10T07:53:39.000Z</published>
    <updated>2021-12-10T09:00:53.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><table><thead><tr><th>主机名</th><th>网卡信息</th><th>角色</th></tr></thead><tbody><tr><td>client</td><td>IP1：10.10.80.102/24（仅主机）<br/> 网关：10.10.80.101<br/>DNS：114.114.114.114</td><td>客户端</td></tr><tr><td>gateway</td><td>IP1：10.10.80.101/24（仅主机）<br>IP2：10.10.70.101/24 （NAT）<br/> 网关：10.10.70.254<br/>DNS：114.114.114.114</td><td>网关</td></tr></tbody></table><h3 id="服务配置"><a href="#服务配置" class="headerlink" title="服务配置"></a>服务配置</h3><p><strong>gateway</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开启转发</span></span><br><span class="line">echo &quot;net.ipv4.ip_forward = 1&quot; &gt;&gt; /etc/sysctl.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使转发生效</span></span><br><span class="line">sysctl -p</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">开启伪装IP</span></span><br><span class="line">firewall-cmd --add-masquerade --permanent</span><br><span class="line">success</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">配置NAT规则、</span></span><br><span class="line"><span class="meta">#</span><span class="bash">ens34是外网网卡</span></span><br><span class="line"><span class="meta">#</span><span class="bash">10.10.80.0/24 内网网段</span></span><br><span class="line">firewall-cmd --permanent --direct --passthrough ipv4 -t nat -I POSTROUTING -o ens34 -j MASQUERADE -s 10.10.80.0/24 </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">防火墙重载</span></span><br><span class="line">firewall-cmd --reload </span><br><span class="line">success</span><br></pre></td></tr></table></figure><p><strong>client</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">客户端把网关与DNS配置好</span></span><br><span class="line">nmcli device show </span><br><span class="line">GENERAL.DEVICE:                         ens32</span><br><span class="line">GENERAL.TYPE:                           ethernet</span><br><span class="line">GENERAL.HWADDR:                         00:0C:29:09:74:CF</span><br><span class="line">GENERAL.MTU:                            1500</span><br><span class="line">GENERAL.STATE:                          100 (connected)</span><br><span class="line">GENERAL.CONNECTION:                     ens32</span><br><span class="line">GENERAL.CON-PATH:                       /org/freedesktop/NetworkManager/ActiveConnection/2</span><br><span class="line">WIRED-PROPERTIES.CARRIER:               on</span><br><span class="line">IP4.ADDRESS[1]:                         10.10.80.102/24</span><br><span class="line">IP4.GATEWAY:                            10.10.80.101</span><br><span class="line">IP4.ROUTE[1]:                           dst = 10.10.80.0/24, nh = 0.0.0.0, mt = 100</span><br><span class="line">IP4.ROUTE[2]:                           dst = 0.0.0.0/0, nh = 10.10.80.101, mt = 100</span><br><span class="line">IP4.DNS[1]:                             114.114.114.114</span><br><span class="line">IP6.ADDRESS[1]:                         fe80::219a:a6bc:daab:1943/64</span><br><span class="line">IP6.GATEWAY:                            --</span><br><span class="line">IP6.ROUTE[1]:                           dst = fe80::/64, nh = ::, mt = 100</span><br><span class="line">IP6.ROUTE[2]:                           dst = ff00::/8, nh = ::, mt = 256, table=255</span><br><span class="line"></span><br><span class="line">GENERAL.DEVICE:                         lo</span><br><span class="line">GENERAL.TYPE:                           loopback</span><br><span class="line">GENERAL.HWADDR:                         00:00:00:00:00:00</span><br><span class="line">GENERAL.MTU:                            65536</span><br><span class="line">GENERAL.STATE:                          10 (unmanaged)</span><br><span class="line">GENERAL.CONNECTION:                     --</span><br><span class="line">GENERAL.CON-PATH:                       --</span><br><span class="line">IP4.ADDRESS[1]:                         127.0.0.1/8</span><br><span class="line">IP4.GATEWAY:                            --</span><br><span class="line">IP6.ADDRESS[1]:                         ::1/128</span><br><span class="line">IP6.GATEWAY:                            --</span><br><span class="line">IP6.ROUTE[1]:                           dst = ::1/128, nh = ::, mt = 256</span><br><span class="line"><span class="meta">#</span><span class="bash">使用ping命令测试 是否能使用</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="网关" scheme="https://www.hnswxx.cn/tags/%E7%BD%91%E5%85%B3/"/>
    
  </entry>
  
  <entry>
    <title>MariaDB 主从复制</title>
    <link href="https://www.hnswxx.cn/2021/12/10/mariadb-master-slave-replication/"/>
    <id>https://www.hnswxx.cn/2021/12/10/mariadb-master-slave-replication/</id>
    <published>2021-12-10T00:44:38.000Z</published>
    <updated>2021-12-10T01:01:47.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="MySQL-Replication"><a href="#MySQL-Replication" class="headerlink" title="MySQL Replication"></a>MySQL Replication</h3><p>MySQL复制，MySQL的复制默认为异步工作模式，mysql的复制功能是mysql内置的，装上它之后就具备了这个功能，而mysql复制是mysql实现大规模高性能应用的一个基本工具，是 mysql完成水平扩展的基本架构，为了能够应付更多的访问请求，通常情况下我们需要对服务器进行扩展，而扩展通常有两种方式：向上扩展和向外扩展；</p><p><strong>向上扩展：</strong>scale on，也称为垂直扩展，一般是扩充服务器的内存或CPU颗数的这种就是向上扩展。</p><p><strong>向外扩展：</strong>scale out，也称为水平扩展，比较一台服务器不够，再加一台服务器，再不够再加，这种情况就是向外扩展。</p><p>其实MySQL的的复制功能就是使用MySQL向外扩展的能力，也就是水平扩展的功能。</p><p><strong>所谓同步的复制：</strong>首先主服务器每更新一条数据先写到磁盘文件中，同时还要写一个到二进制日志文件中，从服务器就会到主服务器请求二进制信息保存在中继日志中，保存好后由本地 的SQL thread从中继日志应用到从服务器的本地有磁盘文件中，当这个过程完成之后再由从服务器返回确认结果给主服务器，主服务器才返回结果给客户端的。<br><strong>所谓异步复制：</strong>当主服务器要写数据时，先写到本地的磁盘，同时写到二进制文件日志中，写好二进制日志文件后就把结果返回给客户端，至于从服务有没有来主服务器同步二进制日志他不关心。<br>注意：在做复制时双方的的MySQL要一致，如果不一致，主的要低于从的。</p><p>  MySQL主从服务的工作原理图：</p><p><a href="https://imgtu.com/i/o4qZfH"><img src="https://s1.ax1x.com/2021/12/10/o4qZfH.png" alt="o4qZfH.png"></a></p><p>  这里还要注意，如果从服务器不断的到主服务器来请求数据，发现这些数据已经是最新的数据了，那从服务器的I/O thread将会转为睡眠状态，因为主服务器会通知，而I/O线程不会做轮循，从服务器的二进制日志文件通常是被关闭状态的，从服务器是不允许执行写操作 的</p><p>下面来完成主从复制的基本操作步骤:</p><ol><li>这里我们要有两台主机、我这里使用克隆主服务器的主机当做从服务器、首先要把虚拟主机关机才可以克隆的：</li></ol><p><a href="https://imgtu.com/i/o4LFvn"><img src="https://s1.ax1x.com/2021/12/10/o4LFvn.png" alt="o4LFvn.png"></a></p><p><a href="https://imgtu.com/i/o4LED0"><img src="https://s1.ax1x.com/2021/12/10/o4LED0.png" alt="o4LED0.png"></a></p><p><a href="https://imgtu.com/i/o4LVbV"><img src="https://s1.ax1x.com/2021/12/10/o4LVbV.png" alt="o4LVbV.png"></a></p><p>  克隆完之后我们就开机登录、确保主从服务器都正常运行了即可：</p><p><a href="https://imgtu.com/i/o4Ln5F"><img src="https://s1.ax1x.com/2021/12/10/o4Ln5F.png" alt="o4Ln5F.png"></a></p><p><a href="https://imgtu.com/i/o4LM8J"><img src="https://s1.ax1x.com/2021/12/10/o4LM8J.png" alt="o4LM8J.png"></a></p><p><a href="https://imgtu.com/i/o4LQ29"><img src="https://s1.ax1x.com/2021/12/10/o4LQ29.png" alt="o4LQ29.png"></a></p><p><a href="https://imgtu.com/i/o4LlvR"><img src="https://s1.ax1x.com/2021/12/10/o4LlvR.png" alt="o4LlvR.png"></a></p><ol start="2"><li><p>做主从复制最重要的一点就是双方的server-id不能相同；然而<strong>在主服务器上只需要三步</strong>：</p><ol><li><p>就是改server-id</p></li><li><p>启用二进制日志</p></li><li><p>创建有复制权限的帐号</p></li></ol></li></ol><p><a href="https://imgtu.com/i/o4Ld8H"><img src="https://s1.ax1x.com/2021/12/10/o4Ld8H.png" alt="o4Ld8H.png"></a></p><p>  改好之后保存退出即可，再重启服务器，创建二进制目录：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/binlogs</span><br><span class="line">chown -R mysql.mysql /data/binlogs</span><br><span class="line"><span class="meta">#</span><span class="bash">重启主服务器的mysql服务;</span></span><br><span class="line">service mysqld restart　</span><br></pre></td></tr></table></figure><p>  而后连接到主服务器上授权一个有复制权限的帐号：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -hlocalhost -p    </span><br><span class="line">MariaDB [hellodb]&gt; GRANT REPLICATION SLAVE,REPLICATION CLIENT ON *.* TO &#x27;repluser&#x27;@&#x27;172.16.251.156&#x27; IDENTIFIED BY &#x27;replpass&#x27;;</span><br><span class="line">MariaDB [hellodb]&gt; FLUSH PRIVILEGES;</span><br></pre></td></tr></table></figure><ol start="3"><li><p><strong>在从服务器上有以下几步</strong>：</p><ol><li><p>改server-id</p></li><li><p>启用中继日志</p></li><li><p>连接主服务器</p></li><li><p>启动复制线程</p></li></ol></li></ol><p><a href="https://imgtu.com/i/o4LWGQ"><img src="https://s1.ax1x.com/2021/12/10/o4LWGQ.png" alt="o4LWGQ.png"></a></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">mkdir /data/relaylogs/</span><br><span class="line">chown -R mysql.mysql /data/relaylogs</span><br><span class="line">重启mysql服务：</span><br><span class="line">service mysqld restart</span><br><span class="line">再连到从服务器的mysql服务器上：</span><br><span class="line">mysql -uroot -hlocalhost -p</span><br><span class="line">查看一下从服务器的中继日志是否在启动状态：</span><br><span class="line">MariaDB [(none)]&gt; SHOW GLOBAL VARIABLES LIKE &#x27;%relay%&#x27;;</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/o4Lhxs"><img src="https://s1.ax1x.com/2021/12/10/o4Lhxs.png" alt="o4Lhxs.png"></a></p><p>  按照上面的步骤再连接主服务器：   </p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> MASTER_HOST=<span class="string">&#x27;172.16.251.244&#x27;</span> --主服务器的IP地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MASTER_USER=<span class="string">&#x27;repluser&#x27;</span> --主服务器上授权复制的用户名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MASTER_PASSWORD=<span class="string">&#x27;replpass&#x27;</span> --主服务器上授权用名的密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MASTER_LOG_FILE=<span class="string">&#x27;mysql-bin.000006&#x27;</span> --主服务器上的日志文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> MASTER_LOG_POS=245 --主服务器上日志文件的位置</span></span><br><span class="line">MariaDB [hellodb]&gt; CHANGE MASTER TO MASTER_HOST=&#x27;172.16.251.244&#x27;,MASTER_USER=&#x27;repluser&#x27;,MASTER_PASSWORD=&#x27;replpass&#x27;,MASTER_LOG_FILE=&#x27;master-bin.000006&#x27;,MASTER_LOG_POS=245; #指定日志从哪个位置开始复制</span><br></pre></td></tr></table></figure><p>  但是此时的从服务器还没有工作起来，要使从服务器工作起来还要手动启动复制线程，我们上面的步骤写得很明白：<br>  MariaDB [(none)]&gt; START SLAVE;</p><p><a href="https://imgtu.com/i/o4LIrq"><img src="https://s1.ax1x.com/2021/12/10/o4LIrq.png" alt="o4LIrq.png"></a></p><p><a href="https://imgtu.com/i/o4Loq0"><img src="https://s1.ax1x.com/2021/12/10/o4Loq0.png" alt="o4Loq0.png"></a></p><p><a href="https://imgtu.com/i/o4LHaT"><img src="https://s1.ax1x.com/2021/12/10/o4LHaT.png" alt="o4LHaT.png"></a></p><p><a href="https://imgtu.com/i/o4LOG4"><img src="https://s1.ax1x.com/2021/12/10/o4LOG4.png" alt="o4LOG4.png"></a></p><p>  OK、到这里主服务器算是配置完成了</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="MariaDB" scheme="https://www.hnswxx.cn/tags/MariaDB/"/>
    
  </entry>
  
  <entry>
    <title>从属证书颁发机构</title>
    <link href="https://www.hnswxx.cn/2021/12/09/secondary-certification-authority/"/>
    <id>https://www.hnswxx.cn/2021/12/09/secondary-certification-authority/</id>
    <published>2021-12-09T14:11:54.000Z</published>
    <updated>2021-12-09T15:07:17.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><table><thead><tr><th>主机名</th><th>IP地址</th><th>角色</th></tr></thead><tbody><tr><td>master.skills.com</td><td>10.10.70.101</td><td>主证书颁发机构</td></tr><tr><td>slave.skills.com</td><td>10.10.70.102</td><td>从属证书颁发机构</td></tr></tbody></table><h3 id="配置操作"><a href="#配置操作" class="headerlink" title="配置操作"></a>配置操作</h3><h4 id="master配置"><a href="#master配置" class="headerlink" title="master配置"></a>master配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">首先在这个配置文件里面查看CA证书需要哪些文件和哪些目录</span></span><br><span class="line"><span class="meta">#</span><span class="bash">/etc/pki/tls/openssl.cnf</span> </span><br><span class="line"><span class="meta">#</span><span class="bash">从第55行开始看</span></span><br><span class="line"> 55 [ ca ]</span><br><span class="line"> 56 default_ca      = CA_default            # The default ca secn</span><br><span class="line"> 57 </span><br><span class="line"> 58 #############################################################</span><br><span class="line"> 59 [ CA_default ]</span><br><span class="line"> 60 </span><br><span class="line"> 61 dir             = /etc/pki/CA           # Where everything i里</span><br><span class="line"> 62 certs           = $dir/certs            # Where the issued c处</span><br><span class="line"> 63 crl_dir         = $dir/crl              # Where the issued c处</span><br><span class="line"> 64 database        = $dir/index.txt        # database index fil。</span><br><span class="line"> 65 #unique_subject = no                    # Set to &#x27;no&#x27; to all建</span><br><span class="line"> 66                                         # several certs with。</span><br><span class="line"> 67 new_certs_dir   = $dir/newcerts         # default place for 。</span><br><span class="line"> 68 </span><br><span class="line"> 69 certificate     = $dir/cacert.pem       # The CA certificate书</span><br><span class="line"> 70 serial          = $dir/serial           # The current serial号</span><br><span class="line"> 71 crlnumber       = $dir/crlnumber        # the current crl nu号</span><br><span class="line"> 72                                         # must be commented L </span><br><span class="line"> 73 crl             = $dir/crl.pem          # The current CRL 当L </span><br><span class="line"> 74 private_key     = $dir/private/cakey.pem# The private key 私钥</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看了以上文件以后发现需要在 /etc/pki 下创建CA文件夹</span></span><br><span class="line"><span class="meta">#</span><span class="bash">在CA 文件夹下创建 certs crl private 这三个重要的文件夹其余的可 建</span></span><br><span class="line">mkdir -p /etc/pki/CA/&#123;certs,crl,newcerts,private&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在private 文件夹下创建一个私钥 cakey.pem</span></span><br><span class="line">openssl genrsa -out cakey.pem 4096</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在CA 文件夹下创建 ca根证书</span></span><br><span class="line">openssl req -new -x509 -key private/cakey.pem -out cacert.pem -days #根证书年份</span><br><span class="line">You are about to be asked to enter information that will be incod</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Na.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Shenzhen</span><br><span class="line">Locality Name (eg, city) [Default City]:Shenzhen  </span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:DCN</span><br><span class="line">Organizational Unit Name (eg, section) []:skills  </span><br><span class="line">Common Name (eg, your name or your server&#x27;s hostname) []:CA</span><br><span class="line">Email Address []:</span><br><span class="line"><span class="meta">#</span><span class="bash">在CA 文件夹下创建 数据库索引文件 和 当前序列号</span></span><br><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line">echo 01 &gt; /etc/pki/CA/serial #证书序列号写01从1开始</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">证书颁发机构设置好了</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看根证书信息</span></span><br><span class="line">openssl x509 -in cacert.pem -noout -text</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number:</span><br><span class="line">            08:ea:f3:13:84:1f:9e:8a:00:18:4c:1f:ad:81:62:b8:22:06:90:51</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C = CN, ST = Shenzhen, L = Shenzhen, O = DCN, OU = skills, CN = CA</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  9 22:46:36 2021 GMT</span><br><span class="line">            Not After : Jan  8 22:46:36 2022 GMT</span><br><span class="line">        Subject: C = CN, ST = Shenzhen, L = Shenzhen, O = DCN, OU = skills, CN = CA</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                RSA Public-Key: (4096 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:ba:3f:61:2c:92:83:64:7e:cf:38:21:3c:35:51:</span><br><span class="line">                    25:c4:3a:d4:09:c6:dd:38:2f:a4:a8:57:9b:d6:5e:</span><br><span class="line">                    84:30:34:c2:cd:4c:9e:3f:7d:8e:72:78:08:8b:35:</span><br><span class="line">                    80:bb:3d:b6:8a:89:23:c9:91:8c:ed:91:d6:e7:44:</span><br><span class="line">                    45:4c:48:26:42:83:dc:57:f8:c7:a4:6c:8f:bf:50:</span><br><span class="line">                    55:98:f1:36:1e:6b:8b:70:79:7a:05:75:15:6d:cb:</span><br><span class="line">                    f2:6e:25:ad:91:71:f9:b5:db:2a:ec:e3:5f:12:e8:</span><br><span class="line">                    7a:87:b8:83:ca:8c:fb:2b:e9:6d:d7:a1:6e:cc:b6:</span><br><span class="line">                    c1:0b:26:7e:9b:3e:64:e9:87:8c:7f:30:1f:ea:cb:</span><br><span class="line">                    30:6e:79:79:fb:7a:d2:4c:71:55:f0:a6:30:f5:ba:</span><br><span class="line">                    fc:a5:3f:cf:2f:e4:71:1d:f6:17:e1:27:47:21:b9:</span><br><span class="line">                    fb:5d:74:2a:00:86:e7:f3:b9:74:e4:cb:63:f4:8f:</span><br><span class="line">                    c0:b1:6a:9c:f6:f6:09:80:2f:c8:c0:d8:97:23:28:</span><br><span class="line">                    a5:81:6c:93:02:5e:8f:eb:7b:46:cc:20:61:d5:02:</span><br><span class="line">                    dd:69:7a:ed:91:c7:1d:c3:42:b9:36:4c:47:09:49:</span><br><span class="line">                    c7:ea:eb:bc:33:cc:c9:c5:e7:56:69:c6:6e:c4:a0:</span><br><span class="line">                    16:65:cf:6b:8a:73:fb:b3:59:02:d5:ae:37:f3:b5:</span><br><span class="line">                    ec:70:d8:99:73:3e:5e:fc:96:06:f9:b3:d2:5a:b2:</span><br><span class="line">                    71:36:ef:c9:6b:aa:f5:44:07:94:0a:a7:44:dc:ea:</span><br><span class="line">                    0d:dd:29:e1:7b:7a:5d:07:27:cf:a3:11:c3:97:44:</span><br><span class="line">                    bc:74:aa:ce:92:64:1e:96:f4:1e:85:fc:de:f6:2a:</span><br><span class="line">                    e8:62:12:63:fb:63:78:99:6b:8c:61:88:4e:02:85:</span><br><span class="line">                    74:34:b4:88:0d:7e:e8:fa:4d:3a:c3:21:ef:76:ea:</span><br><span class="line">                    9a:f7:fc:96:ec:07:a4:e6:ff:0c:ab:4b:95:85:72:</span><br><span class="line">                    f3:66:e8:99:f8:da:40:7b:03:5a:bf:da:6d:1a:ea:</span><br><span class="line">                    fa:d2:0a:23:75:08:5d:74:b9:80:07:8c:5a:ac:b4:</span><br><span class="line">                    87:e8:84:ba:7c:c3:4c:e1:42:ca:8c:e2:93:aa:ff:</span><br><span class="line">                    72:8b:1a:66:2b:21:c3:e5:63:8f:62:c8:93:e2:68:</span><br><span class="line">                    a7:76:e3:05:07:31:3a:ee:68:09:e2:10:83:6e:91:</span><br><span class="line">                    7f:89:7c:03:44:f5:c6:50:fe:7b:1b:06:94:b0:23:</span><br><span class="line">                    3c:85:81:5a:23:a6:95:48:cc:bc:93:10:80:0a:5e:</span><br><span class="line">                    76:89:09:40:24:a2:39:15:f2:d4:e7:3c:74:58:74:</span><br><span class="line">                    5b:33:ab:53:49:fe:63:e8:1e:ea:dd:26:74:47:37:</span><br><span class="line">                    3a:2c:59:4b:6f:7f:a0:80:3d:87:c0:d3:17:15:e5:</span><br><span class="line">                    65:45:39</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                17:0E:67:EC:6D:4D:99:1B:23:B9:4B:17:16:05:18:06:9A:07:CF:F7</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:17:0E:67:EC:6D:4D:99:1B:23:B9:4B:17:16:05:18:06:9A:07:CF:F7</span><br><span class="line"></span><br><span class="line">            X509v3 Basic Constraints: critical</span><br><span class="line">                CA:TRUE</span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         34:68:81:ef:51:37:11:97:7a:2a:32:09:14:be:8c:dc:bf:58:</span><br><span class="line">         10:37:3c:8b:64:cd:b9:18:71:d0:17:8b:cd:79:40:bb:3c:dc:</span><br><span class="line">         72:27:a1:61:4b:d2:d9:70:8c:ca:64:3e:27:98:9b:32:0b:9e:</span><br><span class="line">         7d:08:48:d6:12:8c:1e:4b:2d:ff:78:ad:20:16:df:b7:6a:b4:</span><br><span class="line">         fd:a8:2c:92:f1:6d:a6:dd:c8:67:7c:43:ba:e5:ee:b9:ee:d8:</span><br><span class="line">         57:a3:7a:f5:bc:8f:e6:12:25:ab:18:de:a1:be:36:4b:fd:84:</span><br><span class="line">         9d:31:39:c9:53:22:b2:9d:da:58:bb:ba:44:13:a7:f2:ad:ca:</span><br><span class="line">         e4:7e:ac:9c:29:4c:87:91:79:89:a6:a1:6f:6e:7e:91:43:38:</span><br><span class="line">         a4:d7:8d:1c:71:65:d6:b9:2a:0a:b8:f2:53:48:83:1f:ed:85:</span><br><span class="line">         70:ea:c4:8a:bc:bd:04:80:51:91:87:80:ee:ca:78:62:7d:5a:</span><br><span class="line">         9c:3e:6d:fd:54:31:e2:1d:64:76:9f:d8:f6:47:6f:cd:e8:75:</span><br><span class="line">         b8:a9:2c:2c:bb:48:4e:68:53:96:e2:9d:77:07:ae:f2:d2:04:</span><br><span class="line">         5c:c5:ac:b9:34:22:aa:3b:d7:cc:ef:fe:19:94:12:a0:ed:98:</span><br><span class="line">         78:93:25:c2:19:ae:c5:bc:bd:57:39:99:93:28:90:0a:fc:d7:</span><br><span class="line">         b7:67:b5:8a:fe:7f:3b:41:5d:cc:ef:d6:90:c6:27:5f:f2:39:</span><br><span class="line">         53:c5:7e:a3:9f:99:3c:4d:8c:ff:0c:ba:0d:64:64:d9:4f:9d:</span><br><span class="line">         fb:99:0f:b5:40:51:50:2a:60:62:a5:b3:79:3b:22:0b:2f:f1:</span><br><span class="line">         fc:0f:27:11:96:3c:68:62:6f:e6:83:84:f8:4b:c2:26:12:82:</span><br><span class="line">         14:fb:f5:81:a3:47:b2:a5:8e:8a:6e:0f:f2:bf:80:36:f7:63:</span><br><span class="line">         22:87:91:b0:d9:bc:6b:c5:c7:3c:84:d6:97:67:e4:c1:1a:37:</span><br><span class="line">         06:fa:5b:d1:80:42:78:cd:41:7a:79:72:a9:dd:0d:c2:5b:f0:</span><br><span class="line">         a3:75:be:7c:4c:20:0b:7b:91:05:84:49:9c:4d:f1:ff:f7:04:</span><br><span class="line">         32:e0:92:d3:36:17:bd:b7:27:9a:89:67:45:6d:16:4d:6e:1e:</span><br><span class="line">         35:1b:d5:cf:34:4d:b9:85:69:99:f2:68:64:91:d8:e9:8d:b7:</span><br><span class="line">         c2:84:37:f7:4d:c9:b6:21:f0:8b:05:49:66:51:76:e3:f1:10:</span><br><span class="line">         d5:be:f1:83:7c:2e:3c:bb:57:a4:de:25:01:43:7a:8f:39:10:</span><br><span class="line">         c6:a5:3f:92:e8:5d:7e:9e:91:ab:35:75:c6:1c:c4:ce:78:88:</span><br><span class="line">         a4:e6:47:2a:51:2f:9a:6b:ff:50:9e:0b:92:15:fa:68:5c:2e:</span><br><span class="line">         e5:cc:b6:45:32:eb:90:13</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建一个私钥 再用证书颁发机构颁发一个子证书 这个证书作为从属证书颁发机构的根证书</span></span><br><span class="line">openssl genrsa -out cakey.pem</span><br><span class="line">Generating RSA private key, 2048 bit long modulus (2 primes)</span><br><span class="line">...................+++++</span><br><span class="line">............................................+++++</span><br><span class="line">e is 65537 (0x010001)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">创建证书请求文件</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Shenzhen</span><br><span class="line">Locality Name (eg, city) [Default City]:Shenzhen</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:DCN</span><br><span class="line">Organizational Unit Name (eg, section) []:skills</span><br><span class="line">Common Name (eg, your name or your server&#x27;s hostname) []:BCA</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &#x27;extra&#x27; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">签发证书</span></span><br><span class="line">openssl ca -in ca.csr -out cacert.pem</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  9 22:50:26 2021 GMT</span><br><span class="line">            Not After : Dec  9 22:50:26 2022 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = Shenzhen</span><br><span class="line">            organizationName          = DCN</span><br><span class="line">            organizationalUnitName    = skills</span><br><span class="line">            commonName                = BCA</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                0E:F7:63:9B:62:12:E7:0C:C0:92:20:92:6B:19:B3:25:28:F7:DD:7B</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:17:0E:67:EC:6D:4D:99:1B:23:B9:4B:17:16:05:18:06:9A:07:CF:F7</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Dec  9 22:50:26 2022 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">把证书和私钥传到从属证书服务器</span></span><br><span class="line">scp cacert.pem cakey.pem 10.10.70.102:/</span><br><span class="line">The authenticity of host &#x27;10.10.70.102 (10.10.70.102)&#x27; can&#x27;t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:rCfwMbGRzTJHEOwwrDDoeo77AzQVE+xJtfppiOeGgSU.</span><br><span class="line">Are you sure you want to continue connecting (yes/no/[fingerprint])? yes</span><br><span class="line">Warning: Permanently added &#x27;10.10.70.102&#x27; (ECDSA) to the list of known hosts.</span><br><span class="line">root@10.10.70.102&#x27;s password: </span><br><span class="line">cacert.pem                                                         100% 5675     3.5MB/s   00:00    </span><br><span class="line">cakey.pem                                                          100% 1679     1.4MB/s   00:00  </span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">主服务器配置结束</span></span><br></pre></td></tr></table></figure><h4 id="slave配置"><a href="#slave配置" class="headerlink" title="slave配置"></a>slave配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">创建基础文件夹</span></span><br><span class="line">mkdir -p /etc/pki/CA/&#123;certs,crl,newcerts,private&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">把私钥和证书移动到指定位置</span></span><br><span class="line">mv cakey.pem /etc/pki/CA/private/</span><br><span class="line">mv cacert.pem /etc/pki/CA/</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">在CA 文件夹下创建 数据库索引文件 和 当前序列号</span></span><br><span class="line">touch /etc/pki/CA/index.txt</span><br><span class="line">echo 01 &gt; /etc/pki/CA/serial #证书序列号写01从1开始</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">从属证书颁发机构创建完毕</span></span><br></pre></td></tr></table></figure><h4 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">私钥</span></span><br><span class="line">openssl genrsa -out ca.key</span><br><span class="line"><span class="meta">#</span><span class="bash">证书请求文件</span></span><br><span class="line">You are about to be asked to enter information that will be incorporated</span><br><span class="line">into your certificate request.</span><br><span class="line">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class="line">There are quite a few fields but you can leave some blank</span><br><span class="line">For some fields there will be a default value,</span><br><span class="line">If you enter &#x27;.&#x27;, the field will be left blank.</span><br><span class="line">-----</span><br><span class="line">Country Name (2 letter code) [XX]:CN</span><br><span class="line">State or Province Name (full name) []:Shenzhen</span><br><span class="line">Locality Name (eg, city) [Default City]:Shenzhen</span><br><span class="line">Organization Name (eg, company) [Default Company Ltd]:DCN</span><br><span class="line">Organizational Unit Name (eg, section) []:skills</span><br><span class="line">Common Name (eg, your name or your server&#x27;s hostname) []:test              </span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &#x27;extra&#x27; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line"><span class="meta">#</span><span class="bash">签发证书</span></span><br><span class="line">openssl ca -in ca.csr -out ca.crt</span><br><span class="line">Using configuration from /etc/pki/tls/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  9 15:01:17 2021 GMT</span><br><span class="line">            Not After : Dec  9 15:01:17 2022 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = CN</span><br><span class="line">            stateOrProvinceName       = Shenzhen</span><br><span class="line">            organizationName          = DCN</span><br><span class="line">            organizationalUnitName    = skills</span><br><span class="line">            commonName                = test</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                15:50:E6:D4:69:46:06:3D:F4:C7:92:F4:11:83:54:9D:17:8B:41:0C</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:EC:0A:D9:AB:00:1B:5E:EC:00:BB:C7:30:6C:25:1D:55:7B:F5:3C:2D</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Dec  9 15:01:17 2022 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]:y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">1 out of 1 certificate requests certified, commit? [y/n]y</span><br><span class="line">Write out database with 1 new entries</span><br><span class="line">Data Base Updated</span><br><span class="line"><span class="meta">#</span><span class="bash">证书信息</span></span><br><span class="line">openssl x509 -in ca.crt -noout -text</span><br><span class="line">Certificate:</span><br><span class="line">    Data:</span><br><span class="line">        Version: 3 (0x2)</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">        Issuer: C = CN, ST = Shenzhen, O = DCN, OU = skills, CN = BCA</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Dec  9 15:01:17 2021 GMT</span><br><span class="line">            Not After : Dec  9 15:01:17 2022 GMT</span><br><span class="line">        Subject: C = CN, ST = Shenzhen, O = DCN, OU = skills, CN = test</span><br><span class="line">        Subject Public Key Info:</span><br><span class="line">            Public Key Algorithm: rsaEncryption</span><br><span class="line">                RSA Public-Key: (2048 bit)</span><br><span class="line">                Modulus:</span><br><span class="line">                    00:da:c3:c4:b6:40:56:c9:65:29:3d:68:21:66:3e:</span><br><span class="line">                    76:8a:3c:d7:98:df:26:90:89:61:50:02:78:ce:ef:</span><br><span class="line">                    c9:70:cd:70:fe:10:85:71:64:73:df:0b:0a:85:7c:</span><br><span class="line">                    4a:52:6a:13:58:bd:18:4a:85:ba:de:43:c9:b0:ed:</span><br><span class="line">                    6b:c6:77:fc:11:5e:c4:41:b0:03:c9:c0:78:5d:aa:</span><br><span class="line">                    fc:6b:8e:aa:d1:78:59:df:fc:cd:3d:da:97:49:e0:</span><br><span class="line">                    7c:95:c6:52:76:90:79:8a:ff:99:ec:cb:02:66:21:</span><br><span class="line">                    d9:dd:04:7c:69:e4:37:1b:c2:78:f9:b2:46:ec:5f:</span><br><span class="line">                    e6:52:e0:46:25:07:69:d3:c9:80:c1:fd:31:56:d9:</span><br><span class="line">                    08:1c:7a:01:0b:6b:ad:fd:b0:d4:60:57:d0:c1:48:</span><br><span class="line">                    54:60:ce:48:29:69:64:32:82:08:4d:a6:9b:82:5a:</span><br><span class="line">                    9b:37:62:bd:fd:e4:26:e3:a0:c2:2c:7c:e4:32:b1:</span><br><span class="line">                    2b:60:25:af:f5:75:e0:c6:af:34:9b:c6:fe:8f:7d:</span><br><span class="line">                    dc:bb:95:b3:f8:ff:ca:fe:0d:fb:75:61:4a:c5:40:</span><br><span class="line">                    76:19:71:43:47:1d:1f:1f:74:d3:22:8a:dd:56:da:</span><br><span class="line">                    5d:13:44:78:e7:4e:48:7d:54:3e:b7:08:66:82:9d:</span><br><span class="line">                    42:92:84:e9:bc:7e:86:bf:2d:37:79:3a:34:d1:f5:</span><br><span class="line">                    90:6d</span><br><span class="line">                Exponent: 65537 (0x10001)</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints: </span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment: </span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier: </span><br><span class="line">                15:50:E6:D4:69:46:06:3D:F4:C7:92:F4:11:83:54:9D:17:8B:41:0C</span><br><span class="line">            X509v3 Authority Key Identifier: </span><br><span class="line">                keyid:EC:0A:D9:AB:00:1B:5E:EC:00:BB:C7:30:6C:25:1D:55:7B:F5:3C:2D</span><br><span class="line"></span><br><span class="line">    Signature Algorithm: sha256WithRSAEncryption</span><br><span class="line">         09:3c:1e:54:cf:b3:5b:a9:e3:cb:e8:ef:6e:8c:c3:3c:3f:b0:</span><br><span class="line">         60:79:91:d9:61:f5:de:bc:c5:1c:eb:ea:3e:d9:99:21:ae:fb:</span><br><span class="line">         80:63:4e:75:e4:1e:40:74:69:87:da:5b:6b:f6:5f:40:2a:c7:</span><br><span class="line">         2e:52:3e:ce:50:46:e3:49:d5:0e:6f:f5:8a:22:a0:b4:93:d2:</span><br><span class="line">         15:ab:75:98:55:1f:86:f1:0b:18:ec:4a:d2:f1:49:40:df:47:</span><br><span class="line">         81:74:77:7b:ab:42:21:f7:5d:76:64:53:07:62:d5:9c:a2:66:</span><br><span class="line">         b6:56:ec:e7:a5:31:d2:8a:a5:4d:63:6f:f7:24:f9:65:33:58:</span><br><span class="line">         f2:d6:ab:7b:59:86:57:3b:cc:b6:21:4a:13:5c:77:f5:a9:e1:</span><br><span class="line">         53:4c:1e:12:aa:3b:05:34:ac:8e:2d:dd:31:57:32:83:2e:47:</span><br><span class="line">         e0:3b:21:58:f2:92:c2:d4:1c:bf:34:1e:13:f9:a9:74:89:a3:</span><br><span class="line">         a5:cc:7d:69:92:76:dc:75:0d:3c:9a:0b:98:81:65:86:e2:d1:</span><br><span class="line">         fe:e1:ae:60:73:21:e2:98:69:fe:b5:7f:15:e1:b5:cf:1a:39:</span><br><span class="line">         9f:87:e2:9b:e1:89:33:4f:53:b0:46:db:04:6a:42:ce:a5:6d:</span><br><span class="line">         b3:d8:5c:de:c6:f5:f1:a0:a0:82:ad:c1:eb:a0:63:51:df:f1:</span><br><span class="line">         b8:1a:51:13</span><br></pre></td></tr></table></figure><p><a href="https://imgtu.com/i/o4wpfs"><img src="https://s1.ax1x.com/2021/12/09/o4wpfs.md.png" alt="o4wpfs.md.png"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="证书" scheme="https://www.hnswxx.cn/tags/%E8%AF%81%E4%B9%A6/"/>
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
  </entry>
  
  <entry>
    <title>从属LinuxDNS服务器</title>
    <link href="https://www.hnswxx.cn/2021/11/24/linux-dns-secondary-server/"/>
    <id>https://www.hnswxx.cn/2021/11/24/linux-dns-secondary-server/</id>
    <published>2021-11-24T12:24:50.000Z</published>
    <updated>2021-12-09T14:08:16.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><table><thead><tr><th>主机名</th><th>IP地址</th><th>角色</th></tr></thead><tbody><tr><td>master.skills.com</td><td>10.10.70.101</td><td>DNS主服务器</td></tr><tr><td>slave.skills.com</td><td>10.10.70.102</td><td>DNS辅服务器</td></tr></tbody></table><h3 id="服务器配置"><a href="#服务器配置" class="headerlink" title="服务器配置"></a>服务器配置</h3><h5 id="master服务器"><a href="#master服务器" class="headerlink" title="master服务器"></a>master服务器</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">安装DNS服务软件BIND与测试软件BIND-UTILS</span></span><br><span class="line">yum install bind bind-utils -y</span><br><span class="line"><span class="meta">#</span><span class="bash">修改主配置文件</span></span><br><span class="line">/etc/named.conf</span><br><span class="line">        listen-on port 53 &#123; any; &#125;; #11</span><br><span class="line">        allow-query     &#123; any; &#125;;#19</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">正反向解析</span></span><br><span class="line"><span class="meta">#</span><span class="bash">第一步：编辑区域配置文件</span></span><br><span class="line">/etc/named.rfc1912.zones</span><br><span class="line"><span class="meta">#</span><span class="bash">新增两行</span></span><br><span class="line">zone &quot;skills.com&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;skills.com.zone&quot;;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone &quot;70.10.10.in-addr.arpa&quot; IN &#123;</span><br><span class="line">        type master;</span><br><span class="line">        file &quot;10.10.70.arpa&quot;;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">第二布，编写解析配置文件</span></span><br><span class="line">cp -p named.localhost skills.com.zone</span><br><span class="line"><span class="meta">#</span><span class="bash">修改正向解析文件</span></span><br><span class="line">cat skills.com.zone </span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       127.0.0.1</span><br><span class="line">master  A       10.10.70.101</span><br><span class="line">slave   A       10.10.70.102</span><br><span class="line"><span class="meta">#</span><span class="bash">修改反向解析文件</span></span><br><span class="line">cp -p named.loopback 10.10.70.arpa</span><br><span class="line"><span class="meta">$</span><span class="bash">TTL 1D</span></span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       127.0.0.1</span><br><span class="line">101     PTR     master.skills.com.</span><br><span class="line">102     PTR     slave.skills.com.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动DNS服务</span></span><br><span class="line">systemctl start named</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">使用nslookup进行解析测试</span></span><br><span class="line">nslookup master.skills.com</span><br><span class="line">Server:         10.10.70.101</span><br><span class="line">Address:        10.10.70.101#53</span><br><span class="line"></span><br><span class="line">Name:   master.skills.com</span><br><span class="line">Address: 10.10.70.101</span><br><span class="line"></span><br><span class="line">nslookup slave.skills.com</span><br><span class="line">Server:         10.10.70.101</span><br><span class="line">Address:        10.10.70.101#53</span><br><span class="line"></span><br><span class="line">Name:   slave.skills.com</span><br><span class="line">Address: 10.10.70.102</span><br><span class="line"></span><br><span class="line">nslookup 10.10.70.101</span><br><span class="line">101.70.10.10.in-addr.arpa       name = master.skills.com.</span><br><span class="line"></span><br><span class="line">nslookup 10.10.70.102</span><br><span class="line">102.70.10.10.in-addr.arpa       name = slave.skills.com.</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">防火墙开放DNS服务</span></span><br><span class="line">firewall-cmd --add-service=dns</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="slave服务器"><a href="#slave服务器" class="headerlink" title="slave服务器"></a>slave服务器</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装DNS服务软件BIND与测试软件BIND-UTILS</span></span><br><span class="line">yum install <span class="built_in">bind</span> bind-utils -y</span><br><span class="line"><span class="comment">#修改主配置文件</span></span><br><span class="line">/etc/named.conf</span><br><span class="line">        listen-on port 53 &#123; any; &#125;; <span class="comment">#11</span></span><br><span class="line">        allow-query     &#123; any; &#125;;<span class="comment">#19</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#修改区域配置文件</span></span><br><span class="line">/etc/named.rfc1912.zones </span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;skills.com&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> slave;</span><br><span class="line">        masters &#123;10.10.70.101;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;70.10.10.in-addr.arpa&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> slave;</span><br><span class="line">        masters &#123;10.10.70.101;&#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#启动DNS服务</span></span><br><span class="line">systemctl start named</span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">nslookup </span><br><span class="line">&gt; server localhost</span><br><span class="line">Default server: localhost</span><br><span class="line">Address: ::1<span class="comment">#53</span></span><br><span class="line">Default server: localhost</span><br><span class="line">Address: 127.0.0.1<span class="comment">#53</span></span><br><span class="line">&gt; master.skills.com</span><br><span class="line">Server:         localhost</span><br><span class="line">Address:        ::1<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Name:   master.skills.com</span><br><span class="line">Address: 10.10.70.101</span><br><span class="line">&gt; slave.skills.com</span><br><span class="line">Server:         localhost</span><br><span class="line">Address:        ::1<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Name:   slave.skills.com</span><br><span class="line">Address: 10.10.70.102</span><br><span class="line">&gt; 10.10.70.101</span><br><span class="line">101.70.10.10.in-addr.arpa       name = master.skills.com.</span><br><span class="line">&gt; 10.10.70.102</span><br><span class="line">102.70.10.10.in-addr.arpa       name = slave.skills.com.</span><br><span class="line"><span class="comment">#测试成功</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="DNS" scheme="https://www.hnswxx.cn/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>Linux-DNS正反向解析</title>
    <link href="https://www.hnswxx.cn/2021/11/23/dns-forward-and-reverse-resolution/"/>
    <id>https://www.hnswxx.cn/2021/11/23/dns-forward-and-reverse-resolution/</id>
    <published>2021-11-23T07:37:27.000Z</published>
    <updated>2021-12-11T04:37:10.437Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="DNS介绍"><a href="#DNS介绍" class="headerlink" title="DNS介绍"></a>DNS介绍</h3><h4 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h4><hr><p><strong>域名系统</strong>（英文：<strong>D</strong>omain <strong>N</strong>ame <strong>S</strong>ystem，缩写：<strong>DNS</strong>）是互联网的一项服务。它作为将域名和IP地址 相互映射的一个分布式数据库，能够使人更方便地访问互联网。DNS使用UDP端口53。当前，对于每一 级域名长度的限制是63个字符，域名总长度则不能超过253个字符。</p><h4 id="形式"><a href="#形式" class="headerlink" title="形式"></a>形式</h4><hr><p><a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8">域名服务器</a>通常会有两种形式：权威域名服务器，以及缓存域名服务器。 权威域名服务器 下列情况需要有权威域名服务器：想要向全世界提供DNS信息，并对请求给出权威应答。注册了类似 example org的域，而需要将IP指定到其下的<a href="https://baike.baidu.com/item/%E4%B8%BB%E6%9C%BA%E5%90%8D">主机名</a>上。某个IP地址块需要反向DNS项(IP 到主机名)。备 份服务器，或常说的从(slave) 服务器，会在主服务器出现问题或无法访问时来应答查询请求。 </p><h4 id="缓存域名服务器"><a href="#缓存域名服务器" class="headerlink" title="缓存域名服务器"></a>缓存域名服务器</h4><hr><p>下列情况需要有缓存域名服务器： 本地的DNS服务器能够缓存，并比直接向外界的域名服务器请求更快 地得到应答。 当有人查询 <strong><a href="http://www.freebsd.org/">www.FreeBSD.org</a></strong> 时，解析器通常会向上级ISP的域名服务器发出请求，并获得回应。如果有 本地的缓存DNS服务器，查询只有在第一次被缓存DNS服务器发到外部世界。其他的查询不会发向局域 网外，因为它们已经有在本地的缓存了。 </p><h4 id="解析过程"><a href="#解析过程" class="headerlink" title="解析过程"></a>解析过程</h4><hr><p>当一台机器a向其域名服务器A发出域名解析请求时，如果A可以解析，则将解析结果发给a，否则，A将 向其上级域名服务器B发出解析请求，如果B能解析，则将解析结果发给a，如果B无法解析，则将请求发 给再上一级域名服务器C，如此下去，直至解析到为止。</p><h3 id="DNS配置简介"><a href="#DNS配置简介" class="headerlink" title="DNS配置简介"></a>DNS配置简介</h3><h4 id="DNS软件包"><a href="#DNS软件包" class="headerlink" title="DNS软件包"></a>DNS软件包</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@dns /]<span class="comment"># yum install bind bind-utils -y</span></span><br></pre></td></tr></table></figure><h4 id="DNS的主配置文件"><a href="#DNS的主配置文件" class="headerlink" title="DNS的主配置文件"></a>DNS的主配置文件</h4><p>Bind的主配置文件是etc/name.conf,该文件是文本文件，除了主配置文件外，/var/named目录下的所有文件都是DNS服务器的相关配置文件，下面详细讲述这些文件的配置。</p><ol><li>name.conf文件详解</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">options &#123;</span><br><span class="line">    listen-on port 53 &#123; 127.0.0.1; &#125;;      //设置named服务器监听端口及IP地址</span><br><span class="line">    listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">    directory       <span class="string">&quot;/var/named&quot;</span>;    //设置区域数据库文件的默认存放地址</span><br><span class="line">    dump-file       <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">    statistics-file <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">    memstatistics-file <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line"></span><br><span class="line">    allow-query     &#123; localhost; &#125;;   //允许DNS查询客户端</span><br><span class="line">    allow-query-cache &#123; any; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line">logging &#123;</span><br><span class="line">    channel default_debug &#123;</span><br><span class="line">    file <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">    severity dynamic;</span><br><span class="line">&#125;;</span><br><span class="line">&#125;;</span><br><span class="line">view localhost_resolver &#123;</span><br><span class="line">    match-clients      &#123; any; &#125;;</span><br><span class="line">    match-destinations &#123; any; &#125;;</span><br><span class="line">    recursion yes;                  //设置允许递归查询</span><br><span class="line">    include <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="2"><li>区域配置文件/etc/named.rfc1912.zones</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;    //定义了根域</span><br><span class="line">    <span class="built_in">type</span> hint;       //定义服务器类型为hint</span><br><span class="line">    file <span class="string">&quot;named.ca&quot;</span>;  //定义根域的配置文件名</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;localdomain&quot;</span> IN &#123;   //定义正向DNS区域</span><br><span class="line">    <span class="built_in">type</span> master;              //定义区域类型</span><br><span class="line">    file <span class="string">&quot;localdomain.zone&quot;</span>;  //设置对应的正向区域地址数据库文件</span><br><span class="line">    allow-update &#123; none; &#125;;   //设置允许动态更新的客户端地址（none为禁止）</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;localhost&quot;</span> IN &#123;</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;localhost.zone&quot;</span>;</span><br><span class="line">    allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;0.0.127.in-addr.arpa&quot;</span> IN &#123;   //设置反向DNS区域</span><br><span class="line">    <span class="built_in">type</span> master;</span><br><span class="line">    file <span class="string">&quot;named.local&quot;</span>;</span><br><span class="line">    allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>根域配置文件named.ca</p><p>根域配置文件设定根域的域名数据库，包括根域中13台DNS服务器的信息。几乎所有系统的这个文件都是一样的，用户不需要进行修改。</p></li><li><p>正向域名解析数据库文件</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 600</span><br><span class="line">@        IN   SOA    dns.cwlinux.com   dnsadmin.cwlinux.com. (//SOA字段</span><br><span class="line">                          2015031288   //版本号    同步一次  +1</span><br><span class="line">                             1H        //更新时间</span><br><span class="line">                             2M        // 更新失败，重试更新时间</span><br><span class="line">                             2D        // 更新失败多长时间后此DNS失效时间</span><br><span class="line">                             1D        //解析不到请求不予回复时间</span><br><span class="line">)</span><br><span class="line">         IN    NS   dns            //有两域名服务器</span><br><span class="line">         IN    NS   ns2</span><br><span class="line">         IN    MX  10 mial        // 定义邮件服务器，10指优先级  0-99 数字越小优先级越高</span><br><span class="line">ns2      IN    A    192.168.1.113  //ns2域名服务器的ip地址</span><br><span class="line">dns      IN    A    192.168.1.10   //dns域名服务器的ip地址</span><br><span class="line">mail     IN    A    192.168.1.111   //邮件服务器的ip地址</span><br><span class="line">www      IN    A    192.168.1.112   //www.cwlinux.com的ip地址</span><br><span class="line">pop      IN   CNAME  mail         //pop的正式名字是mail</span><br><span class="line">ftp      IN   CNAME  www         //ftp的正式名字是www</span><br></pre></td></tr></table></figure><ol start="5"><li>反向域名解析数据库文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$TTL</span> 600</span><br><span class="line">@         IN   SOA    dns.cwlinux.com.   dnsadmin.cwlinux.com. (</span><br><span class="line">                             2014031224</span><br><span class="line">                             1H</span><br><span class="line">                             2M</span><br><span class="line">                             2D</span><br><span class="line">                             1D</span><br><span class="line">)</span><br><span class="line">         IN   NS      dns.cwlinux.com.</span><br><span class="line">10       IN   PTR     dns.cwlinux.com.     //反向解析PTR格式</span><br><span class="line">111       IN   PTR     mail.cwlinux.com.</span><br><span class="line">112       IN   PTR     www.cwlinux.com.</span><br><span class="line">// 声明域的时候已经有了，192.168.1 所以我们只需要输入10既代表192.168.1.10jc</span><br></pre></td></tr></table></figure><h3 id="DNS配置示例"><a href="#DNS配置示例" class="headerlink" title="DNS配置示例"></a>DNS配置示例</h3><h4 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h4><table><thead><tr><th align="center">IP</th><th align="center">主机名</th><th>角色</th></tr></thead><tbody><tr><td align="center">192.168.10.102</td><td align="center">dns.skills.com</td><td>DNS服务器</td></tr></tbody></table><h4 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改/etc/named.conf </span></span><br><span class="line">//</span><br><span class="line">// named.conf</span><br><span class="line">//</span><br><span class="line">// Provided by Red Hat <span class="built_in">bind</span> package to configure the ISC BIND named(8) DNS</span><br><span class="line">// server as a caching only nameserver (as a localhost DNS resolver only).</span><br><span class="line">//</span><br><span class="line">// See /usr/share/doc/<span class="built_in">bind</span>*/sample/ <span class="keyword">for</span> example named configuration files.</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">options &#123;</span><br><span class="line">        listen-on port 53 &#123; any; &#125;; <span class="comment">#设置named服务器监听端口及IP地址 为any</span></span><br><span class="line">        listen-on-v6 port 53 &#123; ::1; &#125;;</span><br><span class="line">        directory       <span class="string">&quot;/var/named&quot;</span>;</span><br><span class="line">        dump-file       <span class="string">&quot;/var/named/data/cache_dump.db&quot;</span>;</span><br><span class="line">        statistics-file <span class="string">&quot;/var/named/data/named_stats.txt&quot;</span>;</span><br><span class="line">        memstatistics-file <span class="string">&quot;/var/named/data/named_mem_stats.txt&quot;</span>;</span><br><span class="line">        secroots-file   <span class="string">&quot;/var/named/data/named.secroots&quot;</span>;</span><br><span class="line">        recursing-file  <span class="string">&quot;/var/named/data/named.recursing&quot;</span>;</span><br><span class="line">        allow-query     &#123; any; &#125;; <span class="comment">#允许DNS查询客户端</span></span><br><span class="line"></span><br><span class="line">        /* </span><br><span class="line">         - If you are building an AUTHORITATIVE DNS server, <span class="keyword">do</span> NOT <span class="built_in">enable</span> recursion.</span><br><span class="line">         - If you are building a RECURSIVE (caching) DNS server, you need to <span class="built_in">enable</span> </span><br><span class="line">           recursion. </span><br><span class="line">         - If your recursive DNS server has a public IP address, you MUST <span class="built_in">enable</span> access </span><br><span class="line">           control to <span class="built_in">limit</span> queries to your legitimate users. Failing to <span class="keyword">do</span> so will</span><br><span class="line">           cause your server to become part of large scale DNS amplification </span><br><span class="line">           attacks. Implementing BCP38 within your network would greatly</span><br><span class="line">           reduce such attack surface </span><br><span class="line">        */</span><br><span class="line">        recursion yes;</span><br><span class="line"></span><br><span class="line">        dnssec-enable yes;</span><br><span class="line">        dnssec-validation yes;</span><br><span class="line"></span><br><span class="line">        managed-keys-directory <span class="string">&quot;/var/named/dynamic&quot;</span>;</span><br><span class="line"></span><br><span class="line">        pid-file <span class="string">&quot;/run/named/named.pid&quot;</span>;</span><br><span class="line">        session-keyfile <span class="string">&quot;/run/named/session.key&quot;</span>;</span><br><span class="line"></span><br><span class="line">        /* https://fedoraproject.org/wiki/Changes/CryptoPolicy */</span><br><span class="line">        include <span class="string">&quot;/etc/crypto-policies/back-ends/bind.config&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">logging &#123;</span><br><span class="line">        channel default_debug &#123;</span><br><span class="line">                file <span class="string">&quot;data/named.run&quot;</span>;</span><br><span class="line">                severity dynamic;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;.&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> hint;</span><br><span class="line">        file <span class="string">&quot;named.ca&quot;</span>;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">include <span class="string">&quot;/etc/named.rfc1912.zones&quot;</span>;</span><br><span class="line">include <span class="string">&quot;/etc/named.root.key&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改/etc/named.rfc1912.zones </span></span><br><span class="line"><span class="comment">#定义正反向区域</span></span><br><span class="line">zone <span class="string">&quot;skills.com&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;skills.com.zone&quot;</span>;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">zone <span class="string">&quot;10.168.192.in-addr.arpa&quot;</span> IN &#123;</span><br><span class="line">        <span class="built_in">type</span> master;</span><br><span class="line">        file <span class="string">&quot;192.168.10.arpa&quot;</span>;</span><br><span class="line">        allow-update &#123; none; &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#增加正反向解析数据库文件</span></span><br><span class="line"><span class="built_in">cd</span> /var/named/</span><br><span class="line">cp -p named.localhost skills.com.zone</span><br><span class="line">cp -p named.loopback 192.168.10.arpa</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改正反向数据库文件</span></span><br><span class="line"><span class="comment">#skills.com.zone 正向解析</span></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       127.0.0.1</span><br><span class="line">dns     A       192.168.10.102</span><br><span class="line">abc     A       192.168.10.103</span><br><span class="line">bcd     A       192.168.10.104</span><br><span class="line"></span><br><span class="line"><span class="comment">#192.168.10.arpa 反向解析</span></span><br><span class="line"><span class="variable">$TTL</span> 1D</span><br><span class="line">@       IN SOA  @ rname.invalid. (</span><br><span class="line">                                        0       ; serial</span><br><span class="line">                                        1D      ; refresh</span><br><span class="line">                                        1H      ; retry</span><br><span class="line">                                        1W      ; expire</span><br><span class="line">                                        3H )    ; minimum</span><br><span class="line">        NS      @</span><br><span class="line">        A       127.0.0.1</span><br><span class="line">102     PTR     dns.skills.com.</span><br><span class="line">103     PTR     abc.skills.com.</span><br><span class="line">104     PTR     bcd.skills.com.</span><br><span class="line"></span><br><span class="line"><span class="comment">#nslookup 测试 （本机DNS设置为本机IP自测）</span></span><br><span class="line"><span class="comment">#正向测试</span></span><br><span class="line">nslookup </span><br><span class="line">&gt; dns.skills.com</span><br><span class="line">Server:         192.168.10.102</span><br><span class="line">Address:        192.168.10.102<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Name:   dns.skills.com</span><br><span class="line">Address: 192.168.10.102</span><br><span class="line">&gt; abc.skills.com</span><br><span class="line">Server:         192.168.10.102</span><br><span class="line">Address:        192.168.10.102<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Name:   abc.skills.com</span><br><span class="line">Address: 192.168.10.103</span><br><span class="line">&gt; bcd.skills.com</span><br><span class="line">Server:         192.168.10.102</span><br><span class="line">Address:        192.168.10.102<span class="comment">#53</span></span><br><span class="line"></span><br><span class="line">Name:   bcd.skills.com</span><br><span class="line">Address: 192.168.10.104</span><br><span class="line">&gt; </span><br><span class="line"></span><br><span class="line"><span class="comment">#反向测试</span></span><br><span class="line">nslookup </span><br><span class="line">&gt; 192.168.10.102</span><br><span class="line">102.10.168.192.in-addr.arpa     name = dns.skills.com.</span><br><span class="line">&gt; 192.168.10.103</span><br><span class="line">103.10.168.192.in-addr.arpa     name = abc.skills.com.</span><br><span class="line">&gt; 192.168.10.104</span><br><span class="line">104.10.168.192.in-addr.arpa     name = bcd.skills.com.</span><br><span class="line">&gt; </span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="DNS" scheme="https://www.hnswxx.cn/tags/DNS/"/>
    
  </entry>
  
  <entry>
    <title>Centos7&amp;Centos8本地yum源配置（VMware）</title>
    <link href="https://www.hnswxx.cn/2021/11/22/yum-local-source-configuration/"/>
    <id>https://www.hnswxx.cn/2021/11/22/yum-local-source-configuration/</id>
    <published>2021-11-22T02:01:49.000Z</published>
    <updated>2021-11-22T04:02:08.467Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><h4 id="yum介绍"><a href="#yum介绍" class="headerlink" title="yum介绍"></a>yum介绍</h4></div><p>​    Yum（全称为 Yellow dog Updater, Modified/黄狗更新程序，修改）是一个在Fedora和RedHat以及CentOS中的Shell前端软件包管理器。基于RPM包管理，能够从指定的服务器自动下载RPM包并且安装，可以自动处理依赖性关系，并且一次安装所有依赖的软件包，无须繁琐地一次次下载、安装。</p><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><h4 id="常用命令详解"><a href="#常用命令详解" class="headerlink" title="常用命令详解"></a>常用命令详解</h4></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#使用 yum 查找软件包： </span></span><br><span class="line">yum search PACKAGE_NAME</span><br><span class="line"><span class="comment">#列出所有可安装的软件包： </span></span><br><span class="line">yum list PACKAGE_NAME</span><br><span class="line"><span class="comment">#列出所有可更新的软件包： </span></span><br><span class="line">yum list updates</span><br><span class="line"><span class="comment">#列出所有已安装的软件包： </span></span><br><span class="line">yum list installed</span><br><span class="line"><span class="comment">#列出所有已安装但不在 </span></span><br><span class="line">Yum Repository 内的软件包： yum list extras</span><br><span class="line"><span class="comment">#列出所指定的软件包： </span></span><br><span class="line">yum list PACKAGE_NAME</span><br><span class="line"><span class="comment">#使用 yum 获取软件包信息： </span></span><br><span class="line">yum info PACKAGE_NAME</span><br><span class="line"><span class="comment">#列出软件包提供哪些文件：</span></span><br><span class="line">yum provides PACKAGE_NAME</span><br><span class="line"><span class="comment">#找出某个文件所对应的软件包：</span></span><br><span class="line">yum whatprovides FILE_NAME      <span class="comment"># 常常用于查找某个命令所对应的软件包</span></span><br><span class="line"><span class="comment">#更新具体的yum包： </span></span><br><span class="line">yum update PACKAGE_NAME</span><br><span class="line"><span class="comment">#显示已启用的YUM仓库列表：</span></span><br><span class="line">yum repolist</span><br><span class="line"><span class="comment">#清除YUM缓存：</span></span><br><span class="line">yum clean all</span><br><span class="line"><span class="comment">#卸载yum包： </span></span><br><span class="line">yum remove PACKAGE_NAME</span><br><span class="line"><span class="comment">#取出yum包： </span></span><br><span class="line">yum downloader PACKAGE_NAME</span><br><span class="line"><span class="comment">#重新安装一个yum包： </span></span><br><span class="line">yum reinstall  PACKAGE_NAME</span><br><span class="line"><span class="comment">#安装一个yum包：</span></span><br><span class="line">yum install  PACKAGE_NAME</span><br></pre></td></tr></table></figure><div class="note red icon simple"><i class="note-icon fas fa-fan"></i><h4 id="配置文件详解"><a href="#配置文件详解" class="headerlink" title="配置文件详解"></a>配置文件详解</h4></div><p><strong>repo文件的格式</strong></p><p>所有repository 服务器设置都应该遵循如下格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[serverid]</span><br><span class="line">name=Some name <span class="keyword">for</span> this server</span><br><span class="line">baseurl=url://path/to/repository/</span><br></pre></td></tr></table></figure><ul><li><strong>serverid</strong> 是用于区别各个不同的repository，必须有一个独一无二的名称；</li><li><strong>name</strong> 是对repository 的描述，支持像releaseverreleaseverbasearch这样的变量；</li><li><strong>baseurl</strong> 是服务器设置中最重要的部分，只有设置正确，才能从上面获取软件。它的格式是</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseurl=url://server1/path/to/repository/</span><br><span class="line">　　　　 url://server2/path/to/repository/</span><br><span class="line">　　　　 url://server3/path/to/repository/</span><br></pre></td></tr></table></figure><p>其中url 支持的协议有 http:// ftp:// file:// 三种。baseurl 后可以跟多个url，你可以自己改为速度比较快的镜像站，但baseurl 只能有一个，也就是说不能像如下格式：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">baseurl=url://server1/path/to/repository/</span><br><span class="line">baseurl=url://server2/path/to/repository/</span><br><span class="line">baseurl=url://server3/path/to/repository/</span><br></pre></td></tr></table></figure><p>其中url 指向的目录必须是这个repository header 目录的上一级，它也支持$releasever $basearch 这样的变量。<br>url 之后可以加上多个选项，如gpgcheck、exclude、failovermethod 等，比如：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[updates-released]</span><br><span class="line">name=Fedora Core <span class="variable">$releasever</span> - <span class="variable">$basearch</span> - Released Updates</span><br><span class="line">baseurl=http://download.atrpms.net/mirrors/fedoracore/updates/<span class="variable">$releasever</span>/<span class="variable">$basearch</span></span><br><span class="line">　　　　 http://redhat.linux.ee/pub/fedora/linux/core/updates/<span class="variable">$releasever</span>/<span class="variable">$basearch</span></span><br><span class="line">　　　　 http://fr2.rpmfind.net/linux/fedora/core/updates/<span class="variable">$releasever</span>/<span class="variable">$basearch</span></span><br><span class="line">gpgcheck=1</span><br><span class="line">exclude=gaim</span><br><span class="line">failovermethod=priority</span><br></pre></td></tr></table></figure><p>其中gpgcheck，exclude 的含义和[main] 部分相同，但只对此服务器起作用，failovermethode 有两个选项roundrobin 和priority，意思分别是有多个url可供选择时，yum 选择的次序，roundrobin 是随机选择，如果连接失败则使用下一个，依次循环，priority 则根据url 的次序从第一个开始。如果不指明，默认是roundrobin。</p><p>关于变量</p><ul><li><strong>$releasever</strong>：代表发行版的版本，从[main]部分的distroverpkg获取，如果没有，则根据redhat-release包进行判断。</li><li><strong>$arch</strong>：cpu体系，如i686,athlon等</li><li><strong>$basearch</strong>：cpu的基本体系组，如i686和athlon同属i386，alpha和alphaev6同属alpha。</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[main]</span><br><span class="line">cachedir=/var/cache/yum     <span class="comment">#yum下载的RPM包的缓存目录</span></span><br><span class="line">keepcache=0             <span class="comment">#缓存是否保存，1保存，0不保存。</span></span><br><span class="line">logfile=/var/<span class="built_in">log</span>/yum.log    <span class="comment">#yum的日志文件所在的位置</span></span><br><span class="line">exactarch=1             <span class="comment">#在更新的时候，是否允许更新不同版本的RPM包，比如是否在i386上更新i686的RPM包。</span></span><br><span class="line">obsoletes=1             <span class="comment">#这是一个update的参数，简单的说就是相当于upgrade，允许更新陈旧的RPM包。</span></span><br><span class="line">gpgcheck=1             <span class="comment">#是否检查GPG(GNU Private Guard)，一种密钥方式签名。</span></span><br><span class="line">plugins=1              <span class="comment">#是否允许使用插件，默认是0不允许，但是我们一般会用yum-fastestmirror这个插件。</span></span><br><span class="line">installonly_limit=3       <span class="comment">#允许保留多少个内核包。</span></span><br><span class="line">exclude=selinux*         <span class="comment">#屏蔽不想更新的RPM包，可用通配符，多个RPM包之间使用空格分离。</span></span><br></pre></td></tr></table></figure><h4 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h4><div class="tabs" id="yum"><ul class="nav-tabs"><li class="tab active"><button type="button" data-href="#yum-1">Centos7</button></li><li class="tab"><button type="button" data-href="#yum-2">Centos8</button></li></ul><div class="tab-contents"><div class="tab-item-content active" id="yum-1"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /etc/yum.repos.d/ #进入yum仓库配置文件夹</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># ll</span></span><br><span class="line">total 40</span><br><span class="line">-rw-r--r--. 1 root root 1664 Oct 23  2020 CentOS-Base.repo</span><br><span class="line">-rw-r--r--. 1 root root 1309 Oct 23  2020 CentOS-CR.repo</span><br><span class="line">-rw-r--r--. 1 root root  649 Oct 23  2020 CentOS-Debuginfo.repo</span><br><span class="line">-rw-r--r--. 1 root root  314 Oct 23  2020 CentOS-fasttrack.repo</span><br><span class="line">-rw-r--r--. 1 root root  630 Oct 23  2020 CentOS-Media.repo</span><br><span class="line">-rw-r--r--. 1 root root 1331 Oct 23  2020 CentOS-Sources.repo</span><br><span class="line">-rw-r--r--. 1 root root 8515 Oct 23  2020 CentOS-Vault.repo</span><br><span class="line">-rw-r--r--. 1 root root  616 Oct 23  2020 CentOS-x86_64-kernel.repo</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir bak #创建bak文件夹</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mv * bak/ #把不用的文件移动进去</span></span><br><span class="line">mv: cannot move ‘bak’ to a subdirectory of itself, ‘bak/bak’</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mv bak/CentOS-Media.repo . #把要用的CentOS-Media.repo移动出来</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vi CentOS-Media.repo #编辑该文件</span></span><br><span class="line"><span class="comment"># CentOS-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  This repo can be used with mounted DVD media, verify the mount point for</span></span><br><span class="line"><span class="comment">#  CentOS-7.  You can use this repo and yum to install items directly off the</span></span><br><span class="line"><span class="comment">#  DVD ISO that we release.</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># To use this repo, put in your DVD and use it with the other repos too:</span></span><br><span class="line"><span class="comment">#  yum --enablerepo=c7-media [command]</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># or for ONLY the media repo, do this:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#  yum --disablerepo=\* --enablerepo=c7-media [command]</span></span><br><span class="line"></span><br><span class="line">[c7-media]</span><br><span class="line">name=CentOS-<span class="variable">$releasever</span> - Media </span><br><span class="line">baseurl=file:///media/</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-CentOS-7</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /media/ #把镜像挂载到指定的media目录</span></span><br><span class="line">mount: /dev/sr0 is write-protected, mounting read-only</span><br><span class="line">[root@localhost ~]<span class="comment"># yum repolist #查看启用的仓库</span></span><br><span class="line">Loaded plugins: fastestmirror</span><br><span class="line">Loading mirror speeds from cached hostfile</span><br><span class="line">repo id                                     repo name                                           status</span><br><span class="line">c7-media                                    CentOS-7 - Media                                    4,070</span><br><span class="line">repolist: 4,070</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div><div class="tab-item-content" id="yum-2"><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]<span class="comment"># cd /etc/yum.repos.d/</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># ll</span></span><br><span class="line">total 48</span><br><span class="line">-rw-r--r--. 1 root root  719 Nov  9  2020 CentOS-Linux-AppStream.repo</span><br><span class="line">-rw-r--r--. 1 root root  704 Nov  9  2020 CentOS-Linux-BaseOS.repo</span><br><span class="line">-rw-r--r--. 1 root root 1130 Nov  9  2020 CentOS-Linux-ContinuousRelease.repo</span><br><span class="line">-rw-r--r--. 1 root root  318 Nov  9  2020 CentOS-Linux-Debuginfo.repo</span><br><span class="line">-rw-r--r--. 1 root root  732 Nov  9  2020 CentOS-Linux-Devel.repo</span><br><span class="line">-rw-r--r--. 1 root root  704 Nov  9  2020 CentOS-Linux-Extras.repo</span><br><span class="line">-rw-r--r--. 1 root root  719 Nov  9  2020 CentOS-Linux-FastTrack.repo</span><br><span class="line">-rw-r--r--. 1 root root  740 Nov  9  2020 CentOS-Linux-HighAvailability.repo</span><br><span class="line">-rw-r--r--. 1 root root  693 Nov  9  2020 CentOS-Linux-Media.repo</span><br><span class="line">-rw-r--r--. 1 root root  706 Nov  9  2020 CentOS-Linux-Plus.repo</span><br><span class="line">-rw-r--r--. 1 root root  724 Nov  9  2020 CentOS-Linux-PowerTools.repo</span><br><span class="line">-rw-r--r--. 1 root root  898 Nov  9  2020 CentOS-Linux-Sources.repo</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir bak</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mv * bak/</span></span><br><span class="line">mv: cannot move <span class="string">&#x27;bak&#x27;</span> to a subdirectory of itself, <span class="string">&#x27;bak/bak&#x27;</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mv bak/CentOS-Linux-Media.repo .</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># vi CentOS-Linux-Media.repo </span></span><br><span class="line"><span class="comment"># CentOS-Linux-Media.repo</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># You can use this repo to install items directly off the installation media.</span></span><br><span class="line"><span class="comment"># Verify your mount point matches one of the below file:// paths.</span></span><br><span class="line"></span><br><span class="line">[media-baseos]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Media - BaseOS</span><br><span class="line">baseurl=file:///media/CentOS/BaseOS</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line"></span><br><span class="line">[media-appstream]</span><br><span class="line">name=CentOS Linux <span class="variable">$releasever</span> - Media - AppStream</span><br><span class="line">baseurl=file:///media/CentOS/AppStream</span><br><span class="line">gpgcheck=0</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mkdir /media/CentOS</span></span><br><span class="line">[root@localhost yum.repos.d]<span class="comment"># mount /dev/cdrom /media/CentOS/</span></span><br><span class="line">mount: /media/CentOS: WARNING: device write-protected, mounted read-only.</span><br><span class="line">[root@localhost ~]<span class="comment"># yum repolist </span></span><br><span class="line">repo id                                   repo name</span><br><span class="line">media-appstream                           CentOS Linux 8 - Media - AppStream</span><br><span class="line">media-baseos                              CentOS Linux 8 - Media - BaseOS</span><br></pre></td></tr></table></figure><button type="button" class="tab-to-top" aria-label="scroll to top"><i class="fas fa-arrow-up"></i></button></div></div></div>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="YUM" scheme="https://www.hnswxx.cn/tags/YUM/"/>
    
  </entry>
  
  <entry>
    <title>Windows域迁移</title>
    <link href="https://www.hnswxx.cn/2021/11/21/domain-migration/"/>
    <id>https://www.hnswxx.cn/2021/11/21/domain-migration/</id>
    <published>2021-11-21T08:01:20.000Z</published>
    <updated>2021-11-21T09:39:02.096Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="环境介绍"><a href="#环境介绍" class="headerlink" title="环境介绍"></a>环境介绍</h3><table><thead><tr><th align="center">主机名</th><th align="center">IP</th><th align="center">角色</th></tr></thead><tbody><tr><td align="center">dc.skills.com</td><td align="center">10.10.70.101/24</td><td align="center">域控制器</td></tr><tr><td align="center">client1.skills.com</td><td align="center">10.10.70.102/24</td><td align="center">辅域控制器</td></tr></tbody></table><p><a href="https://imgtu.com/i/IjtU6x"><img src="https://z3.ax1x.com/2021/11/21/IjtU6x.md.png" alt="IjtU6x.md.png"></a></p><p><a href="https://imgtu.com/i/Ijt8k4"><img src="https://z3.ax1x.com/2021/11/21/Ijt8k4.png" alt="Ijt8k4.png"></a></p><h3 id="操作步骤-命令版"><a href="#操作步骤-命令版" class="headerlink" title="操作步骤(命令版)"></a>操作步骤(命令版)</h3><blockquote><p>步骤详解</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; ntdsutil.exe</span><br><span class="line">C:\Windows\system32\ntdsutil.exe: ?</span><br><span class="line"></span><br><span class="line"> ?                             - 显示这个帮助信息</span><br><span class="line"> Activate Instance %s          - 设置“NTDS”或特定的 AD LDS 实例</span><br><span class="line">                                作为活动实例。</span><br><span class="line"> Authoritative restore         - 授权还原 DIT 数据库</span><br><span class="line"> Change Service Account %s1 %s2 - 将 AD DS/LDS 服务帐户更改为</span><br><span class="line">                                 用户名为 %s1，密码为 %s2。</span><br><span class="line">                                 使用“NULL”表示空密码，* 表示</span><br><span class="line">                                 从控制台输入密码。</span><br><span class="line"> Configurable Settings         - 管理可配置的设置</span><br><span class="line"> DS Behavior                   - 查看和修改 AD DS/LDS 行为</span><br><span class="line"> Files                         - 管理 AD DS/LDS 数据库文件</span><br><span class="line"> <span class="built_in">Group</span> Membership Evaluation   - 评估给定用户或</span><br><span class="line">                                组的令牌中的 SID。</span><br><span class="line"> Help                          - 显示这个帮助信息</span><br><span class="line"> IFM                           - IFM 媒体创建</span><br><span class="line"> LDAP policies                 - 管理 LDAP 协议策略</span><br><span class="line"> LDAP Port %d                  - 为 AD LDS 实例配置 LDAP 端口。</span><br><span class="line"> List Instances                - 列出该计算机上安装的</span><br><span class="line">                                所有 AD LDS 实例。</span><br><span class="line"> Local Roles                   - 本地 RODC 角色管理</span><br><span class="line"> Metadata cleanup              - 清理不使用的服务器的对象</span><br><span class="line"> Partition management          - 管理目录分区</span><br><span class="line"> Popups off                    - 禁用弹出</span><br><span class="line"> Popups on                     - 启用弹出</span><br><span class="line"> Quit                          - 退出实用工具</span><br><span class="line"> Roles                         - 管理 NTDS 角色所有者令牌</span><br><span class="line"> Security account management   - 管理安全帐户数据库 - 复制</span><br><span class="line">                                 SID 清理</span><br><span class="line"> Semantic database analysis    - 语法检查器</span><br><span class="line"> <span class="built_in">Set</span> DSRM Password             - 重置目录服务还原模式</span><br><span class="line">                                Administrator</span><br><span class="line">帐户密码</span><br><span class="line"></span><br><span class="line"> Snapshot                      - 快照管理</span><br><span class="line"> SSL Port %d                   - 为 AD LDS 实例配置 SSL 端口。</span><br><span class="line"></span><br><span class="line">C:\Windows\system32\ntdsutil.exe: roles</span><br><span class="line">fsmo maintenance: ?</span><br><span class="line"></span><br><span class="line"> ?                             - 显示这个帮助信息</span><br><span class="line"> Connections                   - 连接到一个特定 AD DC/LDS 实例</span><br><span class="line"> Help                          - 显示这个帮助信息</span><br><span class="line"> Quit                          - 返回到上一个菜单</span><br><span class="line"> Seize infrastructure master   - 在已连接的服务器上覆盖结构角色</span><br><span class="line"> Seize naming master           - 覆盖已连接的服务器上的命名主机角色</span><br><span class="line"> Seize PDC                     - 在已连接的服务器上覆盖 PDC 角色</span><br><span class="line"> Seize RID master              - 在已连接的服务器上覆盖 RID 角色</span><br><span class="line"> Seize schema master           - 在已连接的服务器上覆盖架构角色</span><br><span class="line"> <span class="built_in">Select</span> operation target       - 选择的站点，服务器，域，角色和命名上下文</span><br><span class="line"> Transfer infrastructure master - 将已连接的服务器定为结构主机</span><br><span class="line"> Transfer naming master        - 使已连接的服务器成为命名主机</span><br><span class="line"> Transfer PDC                  - 将已连接的服务器定为 PDC</span><br><span class="line"> Transfer RID master           - 将已连接的服务器定为 RID 主机</span><br><span class="line"> Transfer schema master        - 将已连接的服务器定为架构主机</span><br><span class="line"></span><br><span class="line">fsmo maintenance: Connections</span><br><span class="line">server connections: ?</span><br><span class="line"></span><br><span class="line"> ?                             - 显示这个帮助信息</span><br><span class="line"> <span class="built_in">Clear</span> creds                   - 清除以前的连接凭据</span><br><span class="line"> Connect to domain %s          - 连接到 DNS 域名称</span><br><span class="line"> Connect to server %s          - 连接到服务器、DNS 名称[:端口号]</span><br><span class="line"> Help                          - 显示这个帮助信息</span><br><span class="line"> Info                          - 显示连接信息</span><br><span class="line"> Quit                          - 返回到上一个菜单</span><br><span class="line"> <span class="built_in">Set</span> creds %s1 %s2 %s3         - 将连接凭据设置为域 %s1、用户 %s2、密码 %s3。</span><br><span class="line">                                空密码使用<span class="string">&quot;NULL&quot;</span>,</span><br><span class="line">                                从控制台输入密码使用 *。</span><br><span class="line"></span><br><span class="line">server connections: Connect to server client1.skills.com</span><br><span class="line">绑定到 client1.skills.com ...</span><br><span class="line">用本登录的用户的凭证连接 client1.skills.com。</span><br><span class="line">server connections: quit</span><br><span class="line">fsmo maintenance: ?</span><br><span class="line"></span><br><span class="line"> ?                             - 显示这个帮助信息</span><br><span class="line"> Connections                   - 连接到一个特定 AD DC/LDS 实例</span><br><span class="line"> Help                          - 显示这个帮助信息</span><br><span class="line"> Quit                          - 返回到上一个菜单</span><br><span class="line"> Seize infrastructure master   - 在已连接的服务器上覆盖结构角色</span><br><span class="line"> Seize naming master           - 覆盖已连接的服务器上的命名主机角色</span><br><span class="line"> Seize PDC                     - 在已连接的服务器上覆盖 PDC 角色</span><br><span class="line"> Seize RID master              - 在已连接的服务器上覆盖 RID 角色</span><br><span class="line"> Seize schema master           - 在已连接的服务器上覆盖架构角色</span><br><span class="line"> <span class="built_in">Select</span> operation target       - 选择的站点，服务器，域，角色和命名上下文</span><br><span class="line"> Transfer infrastructure master - 将已连接的服务器定为结构主机</span><br><span class="line"> Transfer naming master        - 使已连接的服务器成为命名主机</span><br><span class="line"> Transfer PDC                  - 将已连接的服务器定为 PDC</span><br><span class="line"> Transfer RID master           - 将已连接的服务器定为 RID 主机</span><br><span class="line"> Transfer schema master        - 将已连接的服务器定为架构主机</span><br><span class="line"></span><br><span class="line">fsmo maintenance: Transfer infrastructure master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer naming master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer PDC</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer RID master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance:  Transfer schema master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: quit</span><br><span class="line">C:\Windows\system32\ntdsutil.exe: quit</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure><blockquote><p>纯步骤</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; ntdsutil.exe</span><br><span class="line">C:\Windows\system32\ntdsutil.exe: roles</span><br><span class="line">fsmo maintenance: Connections</span><br><span class="line">server connections: Connect to server client1.skills.com</span><br><span class="line">绑定到 client1.skills.com ...</span><br><span class="line">用本登录的用户的凭证连接 client1.skills.com。</span><br><span class="line">server connections: quit</span><br><span class="line">fsmo maintenance: Transfer infrastructure master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer naming master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer PDC</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: Transfer RID master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=DC,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance:  Transfer schema master</span><br><span class="line">服务器 <span class="string">&quot;client1.skills.com&quot;</span> 知道有关 <span class="number">5</span> 作用</span><br><span class="line">架构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">命名主机 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">PDC - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">RID - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">结构 - CN=NTDS Settings,CN=CLIENT1,CN=Servers,CN=Default<span class="literal">-First</span><span class="literal">-Site</span><span class="literal">-Name</span>,CN=Sites,CN=Configuration,DC=skills,DC=com</span><br><span class="line">fsmo maintenance: quit</span><br><span class="line">C:\Windows\system32\ntdsutil.exe: quit</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure><h3 id="结果输出"><a href="#结果输出" class="headerlink" title="结果输出"></a>结果输出</h3><blockquote><p>dc.skills.com</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt; systeminfo</span><br><span class="line"></span><br><span class="line">主机名:           DC</span><br><span class="line">OS 名称:          Microsoft Windows Server <span class="number">2019</span> Datacenter</span><br><span class="line">OS 版本:          <span class="number">10.0</span>.<span class="number">17763</span> 暂缺 Build <span class="number">17763</span></span><br><span class="line">OS 制造商:        Microsoft Corporation</span><br><span class="line">OS 配置:          额外/备份域控制器</span><br><span class="line">OS 构件类型:      Multiprocessor Free</span><br><span class="line">注册的所有人:     Windows 用户</span><br><span class="line">注册的组织:</span><br><span class="line">产品 ID:          <span class="number">00430</span><span class="literal">-70000</span><span class="literal">-00001</span><span class="literal">-AA289</span></span><br><span class="line">初始安装日期:     <span class="number">2021</span>/<span class="number">11</span>/<span class="number">21</span>, <span class="number">16</span>:<span class="number">55</span>:<span class="number">22</span></span><br><span class="line">系统启动时间:     <span class="number">2021</span>/<span class="number">11</span>/<span class="number">21</span>, <span class="number">17</span>:<span class="number">00</span>:<span class="number">11</span></span><br><span class="line">系统制造商:       VMware, Inc.</span><br><span class="line">系统型号:         VMware7,<span class="number">1</span></span><br><span class="line">系统类型:         x64<span class="literal">-based</span> PC</span><br><span class="line">处理器:           安装了 <span class="number">2</span> 个处理器。</span><br><span class="line">                  [<span class="number">01</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">158</span> Stepping <span class="number">9</span> GenuineIntel ~<span class="number">3600</span> Mhz</span><br><span class="line">                  [<span class="number">02</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">158</span> Stepping <span class="number">9</span> GenuineIntel ~<span class="number">3600</span> Mhz</span><br><span class="line">BIOS 版本:        VMware, Inc. VMW71.<span class="number">00</span>V.<span class="number">16722896</span>.B64.<span class="number">2008100651</span>, <span class="number">2020</span>/<span class="number">8</span>/<span class="number">10</span></span><br><span class="line">Windows 目录:     C:\Windows</span><br><span class="line">系统目录:         C:\Windows\system32</span><br><span class="line">启动设备:         \Device\HarddiskVolume2</span><br><span class="line">系统区域设置:     zh<span class="literal">-cn</span>;中文(中国)</span><br><span class="line">输入法区域设置:   zh<span class="literal">-cn</span>;中文(中国)</span><br><span class="line">时区:             (UTC+<span class="number">08</span>:<span class="number">00</span>) 北京，重庆，香港特别行政区，乌鲁木齐</span><br><span class="line">物理内存总量:     <span class="number">2</span>,<span class="number">047</span> MB</span><br><span class="line">可用的物理内存:   <span class="number">625</span> MB</span><br><span class="line">虚拟内存: 最大值: <span class="number">3</span>,<span class="number">199</span> MB</span><br><span class="line">虚拟内存: 可用:   <span class="number">1</span>,<span class="number">648</span> MB</span><br><span class="line">虚拟内存: 使用中: <span class="number">1</span>,<span class="number">551</span> MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               skills.com</span><br><span class="line">登录服务器:       \\DC</span><br><span class="line">修补程序:         安装了 <span class="number">1</span> 个修补程序。</span><br><span class="line">                  [<span class="number">01</span>]: KB4464455</span><br><span class="line">网卡:             安装了 <span class="number">1</span> 个 NIC。</span><br><span class="line">                  [<span class="number">01</span>]: Intel(<span class="built_in">R</span>) <span class="number">82574</span>L Gigabit Network Connection</span><br><span class="line">                      连接名:      Ethernet0</span><br><span class="line">                      启用 DHCP:   否</span><br><span class="line">                      IP 地址</span><br><span class="line">                        [<span class="number">01</span>]: <span class="number">10.10</span>.<span class="number">70.101</span></span><br><span class="line">                        [<span class="number">02</span>]: fe80::<span class="number">2145</span>:f5f:fdae:de21</span><br><span class="line">Hyper<span class="literal">-V</span> 要求:     已检测到虚拟机监控程序。将不显示 Hyper<span class="literal">-V</span> 所需的功能。</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator&gt;</span><br></pre></td></tr></table></figure><blockquote><p>client1.skills.com</p></blockquote><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">PS</span> C:\Users\Administrator.SKILLS&gt; systeminfo</span><br><span class="line"></span><br><span class="line">主机名:           CLIENT1</span><br><span class="line">OS 名称:          Microsoft Windows Server <span class="number">2019</span> Datacenter</span><br><span class="line">OS 版本:          <span class="number">10.0</span>.<span class="number">17763</span> 暂缺 Build <span class="number">17763</span></span><br><span class="line">OS 制造商:        Microsoft Corporation</span><br><span class="line">OS 配置:          主域控制器</span><br><span class="line">OS 构件类型:      Multiprocessor Free</span><br><span class="line">注册的所有人:     Windows 用户</span><br><span class="line">注册的组织:</span><br><span class="line">产品 ID:          <span class="number">00430</span><span class="literal">-70000</span><span class="literal">-00001</span><span class="literal">-AA289</span></span><br><span class="line">初始安装日期:     <span class="number">2021</span>/<span class="number">11</span>/<span class="number">21</span>, <span class="number">16</span>:<span class="number">48</span>:<span class="number">57</span></span><br><span class="line">系统启动时间:     <span class="number">2021</span>/<span class="number">11</span>/<span class="number">21</span>, <span class="number">17</span>:<span class="number">05</span>:<span class="number">28</span></span><br><span class="line">系统制造商:       VMware, Inc.</span><br><span class="line">系统型号:         VMware7,<span class="number">1</span></span><br><span class="line">系统类型:         x64<span class="literal">-based</span> PC</span><br><span class="line">处理器:           安装了 <span class="number">2</span> 个处理器。</span><br><span class="line">                  [<span class="number">01</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">158</span> Stepping <span class="number">9</span> GenuineIntel ~<span class="number">3600</span> Mhz</span><br><span class="line">                  [<span class="number">02</span>]: Intel64 Family <span class="number">6</span> Model <span class="number">158</span> Stepping <span class="number">9</span> GenuineIntel ~<span class="number">3600</span> Mhz</span><br><span class="line">BIOS 版本:        VMware, Inc. VMW71.<span class="number">00</span>V.<span class="number">16722896</span>.B64.<span class="number">2008100651</span>, <span class="number">2020</span>/<span class="number">8</span>/<span class="number">10</span></span><br><span class="line">Windows 目录:     C:\Windows</span><br><span class="line">系统目录:         C:\Windows\system32</span><br><span class="line">启动设备:         \Device\HarddiskVolume2</span><br><span class="line">系统区域设置:     zh<span class="literal">-cn</span>;中文(中国)</span><br><span class="line">输入法区域设置:   zh<span class="literal">-cn</span>;中文(中国)</span><br><span class="line">时区:             (UTC+<span class="number">08</span>:<span class="number">00</span>) 北京，重庆，香港特别行政区，乌鲁木齐</span><br><span class="line">物理内存总量:     <span class="number">2</span>,<span class="number">047</span> MB</span><br><span class="line">可用的物理内存:   <span class="number">591</span> MB</span><br><span class="line">虚拟内存: 最大值: <span class="number">3</span>,<span class="number">199</span> MB</span><br><span class="line">虚拟内存: 可用:   <span class="number">1</span>,<span class="number">586</span> MB</span><br><span class="line">虚拟内存: 使用中: <span class="number">1</span>,<span class="number">613</span> MB</span><br><span class="line">页面文件位置:     C:\pagefile.sys</span><br><span class="line">域:               skills.com</span><br><span class="line">登录服务器:       \\CLIENT1</span><br><span class="line">修补程序:         安装了 <span class="number">1</span> 个修补程序。</span><br><span class="line">                  [<span class="number">01</span>]: KB4464455</span><br><span class="line">网卡:             安装了 <span class="number">1</span> 个 NIC。</span><br><span class="line">                  [<span class="number">01</span>]: Intel(<span class="built_in">R</span>) <span class="number">82574</span>L Gigabit Network Connection</span><br><span class="line">                      连接名:      Ethernet0</span><br><span class="line">                      启用 DHCP:   否</span><br><span class="line">                      IP 地址</span><br><span class="line">                        [<span class="number">01</span>]: <span class="number">10.10</span>.<span class="number">70.102</span></span><br><span class="line">                        [<span class="number">02</span>]: fe80::b036:<span class="number">15</span>a0:<span class="number">51</span>db:a236</span><br><span class="line">Hyper<span class="literal">-V</span> 要求:     已检测到虚拟机监控程序。将不显示 Hyper<span class="literal">-V</span> 所需的功能。</span><br><span class="line"><span class="built_in">PS</span> C:\Users\Administrator.SKILLS&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Windows" scheme="https://www.hnswxx.cn/categories/Windows/"/>
    
    
    <category term="WindowServer2019" scheme="https://www.hnswxx.cn/tags/WindowServer2019/"/>
    
  </entry>
  
  <entry>
    <title>Kerberos与NFS联动</title>
    <link href="https://www.hnswxx.cn/2021/11/19/kdc-nfs-linkage/"/>
    <id>https://www.hnswxx.cn/2021/11/19/kdc-nfs-linkage/</id>
    <published>2021-11-19T03:19:39.000Z</published>
    <updated>2021-11-22T02:04:00.004Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Kerberos单点登录"><a href="#Kerberos单点登录" class="headerlink" title="Kerberos单点登录"></a>Kerberos单点登录</h3><p>原理图</p><p><a href="https://imgtu.com/i/IHSCo8"><img src="https://z3.ax1x.com/2021/11/19/IHSCo8.png" alt="IHSCo8.png"></a></p><blockquote><p>Kerberos提供了一个集中式的认证服务器结构，认证服务器的功能式实现用户与其访问的服务器间的相互鉴别。（采用的是对称密钥加密技术）</p></blockquote><ul><li><p>AS：认证服务器AS（authenticator server）</p></li><li><p>TGS：票据许可服务器TGS（ticket granting server）</p></li><li><p>Client：客户端</p></li><li><p>Server：服务器</p></li></ul><h4 id="Kerberos凭证"><a href="#Kerberos凭证" class="headerlink" title="Kerberos凭证"></a>Kerberos凭证</h4><h5 id="票据（ticket）："><a href="#票据（ticket）：" class="headerlink" title="票据（ticket）："></a>票据（ticket）：</h5><p>ticket用来安全的在认证服务器和用户请求的服务器之间传递用户的身份，同时也传递附加信息。用来保证使用ticket的用户必须是ticket中指定用户。ticket一旦生产，在生存时间指定的时间内可以被client多次使用，并申请同一个server服务。</p><h5 id="鉴别码（authenticator）："><a href="#鉴别码（authenticator）：" class="headerlink" title="鉴别码（authenticator）："></a>鉴别码（authenticator）：</h5><p>提供信息与ticket中的信息进行比较，一起保证发出ticket的用户信息就是ticket中指定的用户。authenticator只能在一次服务请求中使用，每当client向server申请服务时，必须重新生成authenticator</p><h4 id="Kerberos票据："><a href="#Kerberos票据：" class="headerlink" title="Kerberos票据："></a>Kerberos票据：</h4><p>两种票据：</p><h5 id="服务许可票据（server-granting-ticket）："><a href="#服务许可票据（server-granting-ticket）：" class="headerlink" title="服务许可票据（server granting ticket）："></a>服务许可票据（server granting ticket）：</h5><p> 是客户端请求服务时需要提供的票据</p><p> 用ticket-A表示访问应用服务器X的票据，通过TGS发放</p><h5 id="票据许可票据（ticket-granting-ticket）："><a href="#票据许可票据（ticket-granting-ticket）：" class="headerlink" title="票据许可票据（ticket granting ticket）："></a>票据许可票据（ticket granting ticket）：</h5><p> 客户端访问TGS服务器需要提供的票据，目的是为了申请某一个应用服务器（如nfs，ftp，nis，pcs等）的“服务许可票据”</p><p> 票据由AS发放 用ticket-B表示访问TGS服务器票据 ticket-B在用户登录时向AS申请一次，可以多次重复使用</p><h4 id="Kerberos域（realm）"><a href="#Kerberos域（realm）" class="headerlink" title="Kerberos域（realm）"></a>Kerberos域（realm）</h4><p>构成：一个完整的Kerberos环境包含一个Kerberos服务器，一组工作站和一组应用服务器</p><p>Kerberos服务器数据库中拥有所有参与用户的UID和口令列表</p><p>Kerberos服务器必须与每一个服务器之间共享一个保密密钥（keytab文件）</p><p>所有用户均在Kerberos服务器上注册</p><p>所有服务器均在Kerberos服务器上注册</p><p>领域划分是根据网络的管理边界来划分（网段）</p><h4 id="服务端配置"><a href="#服务端配置" class="headerlink" title="服务端配置"></a>服务端配置</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#安装时间同步 kdc服务端 nfs服务端 </span></span><br><span class="line">yum install krb5-server krb5-libs nfs-utils -y</span><br><span class="line"><span class="comment">#设置hosts</span></span><br><span class="line">10.10.70.101 kdc.skills.com</span><br><span class="line">10.10.70.102 client.skills.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改kdc配置文件</span></span><br><span class="line"><span class="comment">#/etc/krb5.conf</span></span><br><span class="line"><span class="comment"># To opt out of the system crypto-policies configuration of krb5, remove the</span></span><br><span class="line"><span class="comment"># symlink at /etc/krb5.conf.d/crypto-policies which will not be recreated.</span></span><br><span class="line">includedir /etc/krb5.conf.d/</span><br><span class="line"></span><br><span class="line">[logging]</span><br><span class="line">    default = FILE:/var/<span class="built_in">log</span>/krb5libs.log</span><br><span class="line">    kdc = FILE:/var/<span class="built_in">log</span>/krb5kdc.log</span><br><span class="line">    admin_server = FILE:/var/<span class="built_in">log</span>/kadmind.log</span><br><span class="line"></span><br><span class="line">[libdefaults]</span><br><span class="line">    dns_lookup_realm = <span class="literal">false</span></span><br><span class="line">    ticket_lifetime = 24h</span><br><span class="line">    renew_lifetime = 7d</span><br><span class="line">    forwardable = <span class="literal">true</span></span><br><span class="line">    rdns = <span class="literal">false</span></span><br><span class="line">    default_realm = SKILLS.COM</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line"> SKILLS.COM = &#123;</span><br><span class="line">     kdc = kdc.skills.com</span><br><span class="line">     admin_server = kdc.skills.com</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line">[domain_realm]</span><br><span class="line"> .skills.com = SKILLS.COM</span><br><span class="line"> skills.com = SKILLS.COM</span><br><span class="line"></span><br><span class="line"><span class="comment">#/var/kerberos/krb5kdc</span></span><br><span class="line"><span class="comment"># kadm5.acl</span></span><br><span class="line">*/admin@SKILLS.COM      *</span><br><span class="line"><span class="comment"># kdc.conf</span></span><br><span class="line">[kdcdefaults]</span><br><span class="line">    kdc_ports = 88</span><br><span class="line">    kdc_tcp_ports = 88</span><br><span class="line">    spake_preauth_kdc_challenge = edwards25519</span><br><span class="line"></span><br><span class="line">[realms]</span><br><span class="line">SKILLS.COM = &#123;</span><br><span class="line">     <span class="comment">#master_key_type = aes256-cts</span></span><br><span class="line">     acl_file = /var/kerberos/krb5kdc/kadm5.acl</span><br><span class="line">     dict_file = /usr/share/dict/words</span><br><span class="line">     admin_keytab = /var/kerberos/krb5kdc/kadm5.keytab</span><br><span class="line">     supported_enctypes = aes256-cts:normal aes128-cts:normal arcfour-hmac:normal camellia256-cts:normal camellia128-cts:normal</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#初始化kdc数据库</span></span><br><span class="line">kdb5_util create -s</span><br><span class="line"></span><br><span class="line"><span class="comment">#进入kdc数据库</span></span><br><span class="line">kadmin.local </span><br><span class="line">Authenticating as principal nfs/admin@SKILLS.COM with password.</span><br><span class="line"><span class="comment">#创建kdc本机凭据</span></span><br><span class="line">kadmin.local:  addprinc -randkey nfs/kdc.skills.com</span><br><span class="line"><span class="comment">#创建客户端凭据</span></span><br><span class="line">kadmin.local:  addprinc -randkey nfs/client.skills.com</span><br><span class="line"><span class="comment">#导出凭据</span></span><br><span class="line"><span class="comment">#第一个直导出到本地</span></span><br><span class="line">ktadd -kt /etc/krb5.keytab nfs/kdc.skills.com</span><br><span class="line"><span class="comment">#第二个先导出到本地tmp下，再导出到另一台服务器</span></span><br><span class="line">ktadd -kt /tmp/client nfs/client.skills.com</span><br><span class="line"><span class="comment">#把客户端凭据传给客户端</span></span><br><span class="line">scp /tmp/client client.skills.com:/etc/krb5.keytab</span><br><span class="line"><span class="comment">#把kdc主配置文件传送给客户端</span></span><br><span class="line">scp /etc/krb5.conf client.skills.com:/etc/krb5.conf</span><br><span class="line"></span><br><span class="line"><span class="comment">#配置nfs /etc/exports</span></span><br><span class="line">/mnt *(rw,sec=krb5p)</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改hosts文件</span></span><br><span class="line">127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4</span><br><span class="line">::1         localhost localhost.localdomain localhost6 localhost6.localdomain6</span><br><span class="line">10.10.70.101 kdc.skills.com</span><br><span class="line">10.10.70.102 client.skills.com</span><br><span class="line"></span><br><span class="line"><span class="comment">#把hosts穿给客户端服务器</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#把 kadmin.service krb5kdc.service nfs-server.service 服务启动</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#安装凭据</span></span><br><span class="line">kinit -kt /etc/krb5.keytab </span><br></pre></td></tr></table></figure><h4 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置/etc/chrony.conf</span></span><br><span class="line">server 10.10.70.101 iburst</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装kdc工作站 nfs </span></span><br><span class="line">yum install krb5-workstation.x86_64  krb5-libs nfs-utils -y</span><br><span class="line"></span><br><span class="line"><span class="comment">#安装凭据</span></span><br><span class="line">kinit -kt /etc/krb5.keytab </span><br><span class="line"></span><br><span class="line"><span class="comment">#挂载</span></span><br><span class="line">mount kdc.skills.com:/mnt /mnt</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看挂载</span></span><br><span class="line">mount | grep krb5p</span><br><span class="line">kdc.skills.com:/mnt on /mnt <span class="built_in">type</span> nfs4 (rw,relatime,vers=4.2,rsize=131072,wsize=131072,namlen=255,hard,proto=tcp,timeo=600,retrans=2,sec=krb5p,clientaddr=10.10.70.102,local_lock=none,addr=10.10.70.101)</span><br></pre></td></tr></table></figure><blockquote><p>kerberos nfs 挂载不上的原因有</p></blockquote><ol><li><p>使用IP和域名简写挂载</p><p>例如主机名为 client1.skills.com ip地址为 10.10.70.102 的实例，挂载时用的是client1或是 10.10.70.102 进行挂载，结果导致挂载失败，没有用主机的完全域名就无法进行挂载。</p></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="Centos8" scheme="https://www.hnswxx.cn/tags/Centos8/"/>
    
    <category term="Kerberos" scheme="https://www.hnswxx.cn/tags/Kerberos/"/>
    
    <category term="NFS" scheme="https://www.hnswxx.cn/tags/NFS/"/>
    
  </entry>
  
  <entry>
    <title>Windows Server 2019偏门性问题</title>
    <link href="https://www.hnswxx.cn/2021/11/18/problems-of-windows-server/"/>
    <id>https://www.hnswxx.cn/2021/11/18/problems-of-windows-server/</id>
    <published>2021-11-18T12:49:10.000Z</published>
    <updated>2021-11-23T08:17:01.804Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>本章主要解决window server 2019的各种偏门问题</p></blockquote><h3 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h3><h4 id="关闭网络掩码排序功能"><a href="#关闭网络掩码排序功能" class="headerlink" title="关闭网络掩码排序功能"></a>关闭网络掩码排序功能</h4><p><a href="https://imgtu.com/i/ITqMrD"><img src="https://z3.ax1x.com/2021/11/18/ITqMrD.png" alt="ITqMrD.png"></a></p><h4 id="要求动态更新设置为非安全"><a href="#要求动态更新设置为非安全" class="headerlink" title="要求动态更新设置为非安全"></a>要求动态更新设置为非安全</h4><p><a href="https://imgtu.com/i/ITqbz6"><img src="https://z3.ax1x.com/2021/11/18/ITqbz6.md.png" alt="ITqbz6.md.png"></a></p><h3 id="证书"><a href="#证书" class="headerlink" title="证书"></a>证书</h3><h4 id="颁发的证书有效期修改"><a href="#颁发的证书有效期修改" class="headerlink" title="颁发的证书有效期修改"></a>颁发的证书有效期修改</h4><blockquote><p>环境介绍：CA证书有效期20年，CA颁发证书有效期10年</p></blockquote><p><a href="https://imgtu.com/i/IjXnot"><img src="https://z3.ax1x.com/2021/11/21/IjXnot.png" alt="IjXnot.png"></a></p><ol><li><strong>修改注册表</strong></li></ol><p><a href="https://imgtu.com/i/IjXGLj"><img src="https://z3.ax1x.com/2021/11/21/IjXGLj.png" alt="IjXGLj.png"></a></p><ol start="2"><li><strong>修改默认的web服务器证书</strong></li></ol><p><a href="https://imgtu.com/i/IjxDl8"><img src="https://z3.ax1x.com/2021/11/21/IjxDl8.png" alt="IjxDl8.png"></a></p><ol start="3"><li><strong>重启证书颁发机构然后把刚刚创建的web服务器副本添加过来</strong></li></ol><p><a href="https://imgtu.com/i/IjxLkR"><img src="https://z3.ax1x.com/2021/11/21/IjxLkR.png" alt="IjxLkR.png"></a></p><ol start="4"><li><strong>提交证书申请测试</strong></li></ol><p><a href="https://imgtu.com/i/IvSVa9"><img src="https://z3.ax1x.com/2021/11/21/IvSVa9.png" alt="IvSVa9.png"></a></p><ol start="5"><li><strong>查看证书年限</strong></li></ol><p><a href="https://imgtu.com/i/IvSKxK"><img src="https://z3.ax1x.com/2021/11/21/IvSKxK.png" alt="IvSKxK.png"></a></p><h3 id="组策略"><a href="#组策略" class="headerlink" title="组策略"></a>组策略</h3><h4 id="拒绝sys组从网络访问域控制器"><a href="#拒绝sys组从网络访问域控制器" class="headerlink" title="拒绝sys组从网络访问域控制器"></a>拒绝sys组从网络访问域控制器</h4><p><a href="https://imgtu.com/i/opIcCT"><img src="https://z3.ax1x.com/2021/11/23/opIcCT.png" alt="opIcCT.png"></a></p><h4 id="允许manager组本地登录域控制器"><a href="#允许manager组本地登录域控制器" class="headerlink" title="允许manager组本地登录域控制器"></a>允许manager组本地登录域控制器</h4><p><a href="https://imgtu.com/i/opoKiV"><img src="https://z3.ax1x.com/2021/11/23/opoKiV.png" alt="opoKiV.png"></a></p><h4 id="登录时不显示用户名，不显示上次登录，无须按Ctrl-Alt-Del"><a href="#登录时不显示用户名，不显示上次登录，无须按Ctrl-Alt-Del" class="headerlink" title="登录时不显示用户名，不显示上次登录，无须按Ctrl+Alt+Del"></a>登录时不显示用户名，不显示上次登录，无须按Ctrl+Alt+Del</h4><p><a href="https://imgtu.com/i/opTvNt"><img src="https://z3.ax1x.com/2021/11/23/opTvNt.png" alt="opTvNt.png"></a></p><p><a href="https://imgtu.com/i/op7n3T"><img src="https://z3.ax1x.com/2021/11/23/op7n3T.png" alt="op7n3T.png"></a></p><p><a href="https://imgtu.com/i/op78ER"><img src="https://z3.ax1x.com/2021/11/23/op78ER.png" alt="op78ER.png"></a></p><h4 id="审核登录事件，同时审核成功和失败"><a href="#审核登录事件，同时审核成功和失败" class="headerlink" title="审核登录事件，同时审核成功和失败"></a>审核登录事件，同时审核成功和失败</h4><p><a href="https://imgtu.com/i/op7228"><img src="https://z3.ax1x.com/2021/11/23/op7228.png" alt="op7228.png"></a></p><h4 id="禁用“关闭事件跟踪程序”"><a href="#禁用“关闭事件跟踪程序”" class="headerlink" title="禁用“关闭事件跟踪程序”"></a>禁用“关闭事件跟踪程序”</h4><p><a href="https://imgtu.com/i/opHiRK"><img src="https://z3.ax1x.com/2021/11/23/opHiRK.png" alt="opHiRK.png"></a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Windows" scheme="https://www.hnswxx.cn/categories/Windows/"/>
    
    
  </entry>
  
  <entry>
    <title>keepalived.conf配置文件说明</title>
    <link href="https://www.hnswxx.cn/2021/11/17/keepalived-profile/"/>
    <id>https://www.hnswxx.cn/2021/11/17/keepalived-profile/</id>
    <published>2021-11-17T08:24:46.000Z</published>
    <updated>2021-11-17T08:55:40.985Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>keepalived服务安装完成之后，后面的主要工作就是在 keepalived.conf 文件中配置HA和负载均衡。一个功能比较完整的常用的keepalived配置文件，主要包含三块：全局定义块、VRRP实例定义块和虚拟服务器定义块。全局定义块是必须的，如果keepalived只用来做ha，虚拟服务器是可选的。下面是一个功能比较完整的配置文件模板：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#全局定义块</span></span><br><span class="line">global_defs &#123;</span><br><span class="line">    <span class="comment"># 邮件通知配置</span></span><br><span class="line">    notification_email &#123;</span><br><span class="line">        email1</span><br><span class="line">        email2</span><br><span class="line">    &#125;</span><br><span class="line">    notification_email_from email</span><br><span class="line">    smtp_server host</span><br><span class="line">    smtp_connect_timeout num</span><br><span class="line"></span><br><span class="line">    lvs_id string</span><br><span class="line">    router_id string    <span class="comment">## 标识本节点的字条串,通常为hostname</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#VRRP 实例定义块</span></span><br><span class="line">vrrp_sync_group string &#123; </span><br><span class="line">    group &#123;</span><br><span class="line">        string</span><br><span class="line">        string</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">vrrp_instance string &#123;</span><br><span class="line">    state MASTER|BACKUP</span><br><span class="line">    virtual_router_id num</span><br><span class="line">    interface string</span><br><span class="line">    mcast_src_ip @IP </span><br><span class="line">    priority num</span><br><span class="line">    advert_int num</span><br><span class="line">    nopreempt</span><br><span class="line">    smtp_alert</span><br><span class="line">    lvs_sync_daemon_interface string </span><br><span class="line">    authentication &#123;</span><br><span class="line">        auth_type PASS|AH</span><br><span class="line">        auth_pass string</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    virtual_ipaddress &#123;  <span class="comment"># Block limited to 20 IP addresses @IP</span></span><br><span class="line">        @IP</span><br><span class="line">        @IP</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#虚拟服务器定义块</span></span><br><span class="line">virtual_server (@IP PORT)|(fwmark num) &#123; </span><br><span class="line">    delay_loop num</span><br><span class="line">    lb_algo rr|wrr|lc|wlc|sh|dh|lblc </span><br><span class="line">    lb_kind NAT|DR|TUN</span><br><span class="line">    persistence_timeout num </span><br><span class="line">    protocol TCP|UDP</span><br><span class="line">    real_server @IP PORT &#123; </span><br><span class="line">        weight num</span><br><span class="line">        notify_down /path/script.sh</span><br><span class="line">        TCP_CHECK &#123; </span><br><span class="line">            connect_port num </span><br><span class="line">            connect_timeout num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server @IP PORT &#123;</span><br><span class="line">        weight num</span><br><span class="line">        MISC_CHECK &#123;</span><br><span class="line">            misc_path /path_to_script/script.sh(or misc_path “/path_to_script/script.sh &lt;arg_list&gt;”)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    real_server @IP PORT &#123;</span><br><span class="line">        weight num</span><br><span class="line">        HTTP_GET|SSL_GET &#123;</span><br><span class="line">            url &#123; </span><br><span class="line">                <span class="comment"># You can add multiple url block path alphanum</span></span><br><span class="line">                digest alphanum</span><br><span class="line">            &#125;</span><br><span class="line">            connect_port num</span><br><span class="line">            connect_timeout num </span><br><span class="line">            nb_get_retry num </span><br><span class="line">            delay_before_retry num</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="全局定义块"><a href="#全局定义块" class="headerlink" title="全局定义块"></a>全局定义块</h4><ol><li><p>email通知（notification_email、smtp_server、smtp_connect_timeout）：用于服务有故障时发送邮件报警，可选项，不建议用。需要系统开启sendmail服务，建议用第三独立监控服务，如用nagios全面监控代替。</p></li><li><p>lvs_id：lvs负载均衡器标识，在一个网络内，它的值应该是唯一的。</p></li><li><p>router_id：用户标识本节点的名称，通常为hostname</p></li><li><p>花括号｛｝：用来分隔定义块，必须成对出现。如果写漏了，keepalived运行时不会得到预期的结果。由于定义块存在嵌套关系，因此很容易遗漏结尾处的花括号，这点需要特别注意。</p></li></ol><h5 id="VRRP实例定义块"><a href="#VRRP实例定义块" class="headerlink" title="VRRP实例定义块"></a>VRRP实例定义块</h5><ol><li>vrrp_sync_group：同步vrrp级，用于确定失败切换（FailOver）包含的路由实例个数。即在有2个负载均衡器的场景，一旦某个负载均衡器失效，需要自动切换到另外一个负载均衡器的实例是哪</li><li>group：至少要包含一个vrrp实例，vrrp实例名称必须和vrrp_instance定义的一致</li><li>vrrp_instance：vrrp实例名<ol><li><strong>state</strong>：实例状态，只有MASTER 和 BACKUP两种状态，并且需要全部大写。抢占模式下，其中MASTER为工作状态，BACKUP为备用状态。当MASTER所在的服务器失效时，BACKUP所在的服务会自动把它的状态由BACKUP切换到MASTER状态。当失效的MASTER所在的服务恢复时，BACKUP从MASTER恢复到BACKUP状态。</li><li><strong>interface</strong>：对外提供服务的网卡接口，即VIP绑定的网卡接口。如：eth0，eth1。当前主流的服务器都有2个或2个以上的接口（分别对应外网和内网），在选择网卡接口时，一定要核实清楚\</li><li><strong>mcast_src_ip</strong>：本机IP地址</li><li><strong>virtual_router_id</strong>：虚拟路由的ID号，每个节点设置必须一样，可选择IP最后一段使用，相同的 VRID 为一个组，他将决定多播的 MAC 地址。</li><li><strong>priority</strong>：节点优先级，取值范围0～254，MASTER要比BACKUP高</li><li><strong>advert_int</strong>：MASTER与BACKUP节点间同步检查的时间间隔，单位为秒</li><li><strong>lvs_sync_daemon_inteface</strong>：负载均衡器之间的监控接口,类似于 HA HeartBeat 的心跳线。但它的机制优于 Heartbeat，因为它没有“裂脑”这个问题,它是以优先级这个机制来规避这个麻烦的。在 DR 模式中，lvs_sync_daemon_inteface与服务接口interface使用同一个网络接口</li><li><strong>authentication</strong>：验证类型和验证密码。类型主要有 PASS、AH 两种，通常使用PASS类型，据说AH使用时有问题。验证密码为明文，同一vrrp 实例MASTER与BACKUP使用相同的密码才能正常通信。</li><li><strong>smtp_alert</strong>：有故障时是否激活邮件通知</li><li><strong>nopreempt</strong>：禁止抢占服务。默认情况，当MASTER服务挂掉之后，BACKUP自动升级为MASTER并接替它的任务，当MASTER服务恢复后，升级为MASTER的BACKUP服务又自动降为BACKUP，把工作权交给原MASTER。当配置了nopreempt，MASTER从挂掉到恢复，不再将服务抢占过来。</li><li><strong>virtual_ipaddress</strong>：虚拟IP地址池，可以有多个IP，每个IP占一行，不需要指定子网掩码。注意：这个IP必须与我们的设定的vip保持一致。</li></ol></li></ol><h5 id="虚拟服务器virtual-server定义块"><a href="#虚拟服务器virtual-server定义块" class="headerlink" title="虚拟服务器virtual_server定义块"></a>虚拟服务器virtual_server定义块</h5><ol><li><p>virtual_server：定义一个虚拟服务器，这个ip是virtual_ipaddress中定义的其中一个，后面一个空格，然后加上虚拟服务的端口号。</p><ul><li>delay_loop：健康检查时间间隔，单位：秒</li><li>lb_algo：负载均衡调度算法，互联网应用常用方式为wlc或rr</li><li>lb_kind：负载均衡转发规则。包括DR、NAT、TUN 3种，一般使用路由（DR）转发规则。</li><li>persistence_timeout：http服务会话保持时间，单位：秒</li><li>protocol：转发协议，分为TCP和UDP两种</li></ul></li><li><p>real_server：真实服务器IP和端口，可以定义多个</p><ul><li>weight：负载权重，值越大，转发的优先级越高</li><li>notify_down：服务停止后执行的脚本</li><li>TCP_CHECK：服务有效性检测<ul><li>connect_port：服务连接端口</li><li>connect_timeout：服务连接超时时长，单位：秒</li><li>nb_get_retry：服务连接失败重试次数</li><li>delay_before_retry：重试连接间隔，单位：秒</li></ul></li></ul></li></ol>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="keepalived" scheme="https://www.hnswxx.cn/tags/keepalived/"/>
    
    <category term="高可用" scheme="https://www.hnswxx.cn/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>高可用开源方案 Keepalived VS Heartbeat对比</title>
    <link href="https://www.hnswxx.cn/2021/11/16/keepalived_vs_heartbeat/"/>
    <id>https://www.hnswxx.cn/2021/11/16/keepalived_vs_heartbeat/</id>
    <published>2021-11-16T02:19:24.000Z</published>
    <updated>2021-11-16T02:22:11.392Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>最近因为项目需要，简单的试用了两款高可用开源方案：Keepalived和Heartbeat。两者都很流行，但差异还是很大的，现将试用过程中的感受以及相关知识点简单总结一下，供大家选择方案的时候参考。</p><ol><li><p>Keepalived使用更简单：从安装、配置、使用、维护等角度上对比，Keepalived都比Heartbeat要简单得多，尤其是Heartbeat 2.1.4后拆分成3个子项目，安装、配置、使用都比较复杂，尤其是出问题的时候，都不知道具体是哪个子系统出问题了；而Keepalived只有1个安装文件、1个配置文件，配置文件也简单很多；</p></li><li><p>Heartbeat功能更强大：Heartbeat虽然复杂，但功能更强大，配套工具更全，适合做大型集群管理，而Keepalived主要用于集群倒换，基本没有管理功能；</p></li><li><p>协议不同：Keepalived使用VRRP协议进行通信和选举，Heartbeat使用心跳进行通信和选举；Heartbeat除了走网络外，还可以通过串口通信，貌似更可靠；</p></li><li><p>使用方式基本类似：如果要基于两者设计高可用方案，最终都要根据业务需要写自定义的脚本，Keepalived的脚本没有任何约束，随便怎么写都可以；Heartbeat的脚本有约束，即要支持service start/stop/restart这种方式，而且Heartbeart提供了很多默认脚本，简单的绑定ip，启动apache等操作都已经有了；</p></li></ol><blockquote><p>使用建议：<strong>优先使用Keepalived</strong>，当Keepalived不够用的时候才选择Heartbeat</p></blockquote>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="keepalived" scheme="https://www.hnswxx.cn/tags/keepalived/"/>
    
    <category term="高可用" scheme="https://www.hnswxx.cn/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
  <entry>
    <title>Keepalived原理</title>
    <link href="https://www.hnswxx.cn/2021/11/15/keepalived-principle/"/>
    <id>https://www.hnswxx.cn/2021/11/15/keepalived-principle/</id>
    <published>2021-11-15T12:21:57.000Z</published>
    <updated>2021-11-15T12:28:16.968Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="Keepalived简介"><a href="#Keepalived简介" class="headerlink" title="Keepalived简介"></a>Keepalived简介</h3><p>Keepalived是Linux下一个轻量级别的高可用解决方案。高可用：广义来讲，是指整个系统的高可用行；狭义的来讲就是主机的冗余和接管。</p><p>它与HeartBeat实现类似的功能，都可以实现服务或者网络的高可用，但是又有差别，HeartBeat是一个专业的、功能完善的高可用软件，它提供HA软件所需的基本功能，比如：心跳检测、资源接管，检测集群中的服务，在集群节点转移共享IP地址的所有者等等。HeartBeat功能强大，但是部署和使用相对比较麻烦，与HeartBeat相比，Keepalived主要是通过虚拟路由冗余来实现高可用功能，虽然它没有HeartBeat功能强大，但是Keepalived部署和使用非常的简单，所有配置只需要一个配置文件即可以完成。</p><h3 id="Keepalived是什么？"><a href="#Keepalived是什么？" class="headerlink" title="Keepalived是什么？"></a>Keepalived是什么？</h3><p>Keepalived起初是为LVS设计的，专门用来监控集群系统中各个服务节点的状态，它根据TCP/IP参考模型的第三、第四层、第五层交换机制检测每个服务节点的状态，如果某个服务器节点出现异常，或者工作出现故障，Keepalived将检测到，并将出现的故障的服务器节点从集群系统中剔除，这些工作全部是自动完成的，不需要人工干涉，需要人工完成的只是修复出现故障的服务节点。</p><p>后来Keepalived又加入了VRRP的功能，VRRP（VritrualRouterRedundancyProtocol,虚拟路由冗余协议)出现的目的是解决静态路由出现的单点故障问题，通过VRRP可以实现网络不间断稳定运行，因此Keepalvied一方面具有服务器状态检测和故障隔离功能，另外一方面也有HAcluster功能。</p><p>健康检查和失败切换是keepalived的两大核心功能。所谓的健康检查，就是采用tcp三次握手，icmp请求，http请求，udp echo请求等方式对负载均衡器后面的实际的服务器(通常是承载真实业务的服务器)进行保活；而失败切换主要是应用于配置了主备模式的负载均衡器，利用VRRP维持主备负载均衡器的心跳，当主负载均衡器出现问题时，由备负载均衡器承载对应的业务，从而在最大限度上减少流量损失，并提供服务的稳定性。</p><h3 id="VRRP协议与工作原理"><a href="#VRRP协议与工作原理" class="headerlink" title="VRRP协议与工作原理"></a>VRRP协议与工作原理</h3><p>在现实的网络环境中。主机之间的通信都是通过配置静态路由或者(默认网关)来完成的，而主机之间的路由器一旦发生故障，通信就会失效，因此这种通信模式当中，路由器就成了一个单点瓶颈，为了解决这个问题，就引入了VRRP协议。</p><p>VRRP协议是一种容错的主备模式的协议，保证当主机的下一跳路由出现故障时，由另一台路由器来代替出现故障的路由器进行工作，通过VRRP可以在网络发生故障时透明的进行设备切换而不影响主机之间的数据通信。</p><p><a href="https://imgtu.com/i/IRF7wQ"><img src="https://z3.ax1x.com/2021/11/15/IRF7wQ.png" alt="IRF7wQ.png"></a></p><h4 id="虚拟路由器："><a href="#虚拟路由器：" class="headerlink" title="虚拟路由器："></a>虚拟路由器：</h4><p>虚拟路由器是VRRP备份组中所有路由器的集合，它是一个逻辑概念，并不是正真存在的。从备份组外面看备份组中的路由器，感觉组中的所有路由器就像一个 一样，可以理解为在一个组中： 主路由器+所有备份路由器=虚拟路由器。虚拟路由器有一个虚拟的IP地址和MAC地址。主机将虚拟路由器当作默认网关。虚拟MAC地址的格式为00-00-5E-00-01-{VRID}。通常情况下，虚拟路由器回应ARP请求使用的是虚拟MAC地址，只有虚拟路由器做特殊配置的时候，才回应接口的真实MAC地址。</p><h4 id="主路由器（MASTER）："><a href="#主路由器（MASTER）：" class="headerlink" title="主路由器（MASTER）："></a>主路由器（MASTER）：</h4><p>虚拟路由器通过虚拟IP对外提供服务，而在虚拟路由器内部同一时间只有一台物理路由器对外提供服务，这台提供服务的物理路由器被称为主路由器。一般情况下Master是由选举算法产生，它拥有对外服务的虚拟IP，提供各种网络功能，如：ARP请求，ICMP数据转发等。</p><h4 id="备份路由器（BACKUP）："><a href="#备份路由器（BACKUP）：" class="headerlink" title="备份路由器（BACKUP）："></a>备份路由器（BACKUP）：</h4><p>虚拟路由器中的其他物理路由器不拥有对外的虚拟IP，也不对外提供网络功能，仅接受MASTER的VRRP状态通告信息，这些路由器被称为备份路由器。当主路由器失败时，处于BACKUP角色的备份路由器将重新进行选举，产生一个新的主路由器进入MASTER角色，继续提供对外服务，整个切换对用户来说是完全透明的。</p><h3 id="VRRP选举机制"><a href="#VRRP选举机制" class="headerlink" title="VRRP选举机制"></a>VRRP选举机制</h3><p>VRRP路由器在运行过程中有三种状态：</p><ol><li>Initialize状态： 系统启动后就进入Initialize，此状态下路由器不对VRRP报文做任何处理；</li><li>Master状态；</li><li>Backup状态；一般主路由器处于Master状态，备份路由器处于Backup状态。</li></ol><p>VRRP使用选举机制来确定路由器的状态，优先级选举：</p><ol><li>VRRP组中IP拥有者。如果虚拟IP地址与VRRP组中的某台VRRP路由器IP地址相同，则此路由器为IP地址拥有者，这台路由器将被定位主路由器。</li><li>比较优先级。如果没有IP地址拥有者，则比较路由器的优先级，优先级的范围是0~255，优先级大的作为主路由器</li><li>比较IP地址。在没有Ip地址拥有者和优先级相同的情况下，IP地址大的作为主路由器。</li></ol><p>如下图所示，虚拟IP为10.1.1.254，在VRRP组中没有IP地址拥有者，则比较优先级，很明显RB和RA的优先级要大于RC，则比较RA和RB的IP地址，RB的IP地址大。所以RB为组中的主路由器。</p><p><a href="https://imgtu.com/i/IRFLYn"><img src="https://z3.ax1x.com/2021/11/15/IRFLYn.png" alt="IRFLYn.png"></a></p><h3 id="工作过程"><a href="#工作过程" class="headerlink" title="工作过程"></a>工作过程</h3><p>路由器使用VRRP 功能后，会根据优先级确定自己在备份组中的角色。优先级高的路由器成为Master 路由器，优先级低的成为Backup 路由器。Master 拥有对外服务的虚拟IP，提供各种网络功能，并定期发送VRRP 报文，通知备份组内的其他设备自己工作正常；Backup 路由器只接收Master 发来的报文信息，用来监控Master 的运行状态。当Master 失效时，Backup 路由器进行选举，优先级高的Backup 将成为新的Master 。</p><p>在抢占方式下，当Backup 路由器收到VRRP 报文后，会将自己的优先级与报文中的优先级进行比较。如果大于通告报文中的优先级，则成为Master 路由器；否则将保持Backup状态；</p><p>在非抢占方式下，只要Master 路由器没有出现故障，备份组中的路由器始终保持Master 或Backup 状态，Backup 路由器即使随后被配置了更高的优先级也不会成为Master 路由器；</p><p>如果Backup 路由器的定时器超时后仍未收到Master 路由器发送来的VRRP报文，则认为Master 路由器已经无法正常工作，此时Backup 路由器会认为自己是Master 路由器，并对外发送VRRP报文。备份组内的路由器根据优先级选举出Master 路由 器，承担报文的转发功能。</p><h3 id="Keepalvied的工作原理"><a href="#Keepalvied的工作原理" class="headerlink" title="Keepalvied的工作原理"></a>Keepalvied的工作原理</h3><p>Keepalived对服务器运行状态和故障隔离的工作原理：<br>Keepalived工作在TCP/IP参考模型的三层、四层、五层（物理层，链路层）：<br>网络层（3）：Keepalived通过ICMP协议向服务器集群中的每一个节点发送一个ICMP数据包(有点类似与Ping的功能)，如果某个节点没有返回响应数据包，那么认为该节点发生了故障，Keepalived将报告这个节点失效，并从服务器集群中剔除故障节点。</p><p>传输层（4）：Keepalived在传输层里利用了TCP协议的端口连接和扫描技术来判断集群节点的端口是否正常，比如对于常见的WEB服务器80端口。或者SSH服务22端口，Keepalived一旦在传输层探测到这些端口号没有数据响应和数据返回，就认为这些端口发生异常，然后强制将这些端口所对应的节点从服务器集群中剔除掉。</p><p>应用层（5）：，Keepalived的运行方式也更加全面化和复杂化，用户可以通过自定义Keepalived工作方式，例如：可以通过编写程序或者脚本来运行Keepalived，而Keepalived将根据用户的设定参数检测各种程序或者服务是否允许正常，如果Keepalived的检测结果和用户设定的不一致时，Keepalived将把对应的服务器从服务器集群中剔除。</p><h3 id="Keepalived体系结构"><a href="#Keepalived体系结构" class="headerlink" title="Keepalived体系结构"></a>Keepalived体系结构</h3><p>Keepalived起初是为LVS设计的，由于Keeplalived可以实现对集群节点的状态检测，而IPVS可以实现负载均衡功能，因此,Keepalived借助于第三方模块IPVS就可以很方便地搭建一套负载均衡系统。在Keepalived当中IPVS模块是可配置的，如果需要负载均衡功能，可以在编译Keepalived时开打负载均衡功能，也可以通过编译参数关闭。</p><p><a href="https://imgtu.com/i/IRFvlV"><img src="https://z3.ax1x.com/2021/11/15/IRFvlV.png" alt="IRFvlV.png"></a></p><p>SchedulerI/OMultiplexer是一个I/O复用分发调度器，它负载安排Keepalived所有内部的任务请求；</p><p>Memory Mngt是一个内存管理机制，这个框架提供了访问内存的一些通用方法；</p><p>Control Plane 是keepalived的控制版面，可以实现对配置文件编译和解析；</p><p>Core componets 这部分主要包含了5个部分；</p><p>Watchdog：是计算机可靠领域中极为简单又非常有效的检测工具，Keepalived正是通过它监控Checkers和VRRP进程的。<br>Checkers:这是Keepalived最基础的功能，也是最主要的功能，可以实现对服务器运行状态检测和故障隔离。<br>VRRP Stack:这是keepalived后来引用VRRP功能，可以实现HA集群中失败切换功能。负责负载均衡器之间的失败切换FailOver；<br>IPVS wrapper:这个是IPVS功能的一个实现，IPVSwarrper模块将可以设置好的IPVS规则发送的内核空间并且提供给IPVS模块，最终实现IPVS模块的负载功能。<br>Netlink Reflector：用来实现高可用集群Failover时虚拟IP(VIP)的设置和切换，<br>keepalived运行时，会启动3个进程，分别为：core(核心进程)，check和vrrp</p><ul><li>core：负责主进程的启动，维护和全局配置文件的加载；</li><li>check：负责健康检查</li><li>vrrp：用来实现vrrp协议</li></ul><h3 id="与heartbeat-corosync等比较"><a href="#与heartbeat-corosync等比较" class="headerlink" title="与heartbeat/corosync等比较"></a>与heartbeat/corosync等比较</h3><p>　　Heartbeat、Corosync、Keepalived这三个集群组件我们到底选哪个好，Heartbeat、Corosync是属于同一类型，Keepalived与Heartbeat、Corosync，根本不是同一类型的。Keepalived使用的vrrp虚拟路由冗余协议方式；Heartbeat或Corosync是基于主机或网络服务的高可用方式；简单的说就是，Keepalived的目的是模拟路由器的高可用，Heartbeat或Corosync的目的是实现Service的高可用。<br>　　<br>　　所以一般Keepalived是实现前端高可用，常用的前端高可用的组合有，就是我们常见的LVS+Keepalived、Nginx+Keepalived、HAproxy+Keepalived。而Heartbeat或Corosync是实现服务的高可用，常见的组合有Heartbeat v3(Corosync)+Pacemaker+NFS+Httpd 实现Web服务器的高可用、Heartbeat v3(Corosync)+Pacemaker+NFS+MySQL 实现MySQL服务器的高可用。总结一下，Keepalived中实现轻量级的高可用，一般用于前端高可用，且不需要共享存储，一般常用于两个节点的高可用。而Heartbeat(或Corosync)一般用于服务的高可用，且需要共享存储，一般用于多节点的高可用。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; cla</summary>
      
    
    
    
    <category term="Linux" scheme="https://www.hnswxx.cn/categories/Linux/"/>
    
    
    <category term="keepalived" scheme="https://www.hnswxx.cn/tags/keepalived/"/>
    
    <category term="高可用" scheme="https://www.hnswxx.cn/tags/%E9%AB%98%E5%8F%AF%E7%94%A8/"/>
    
  </entry>
  
</feed>
